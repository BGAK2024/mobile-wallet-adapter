<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="2565.625px" preserveAspectRatio="none" style="width:1544px;height:2565px;background:#FFFFFF;" version="1.1" viewBox="0 0 1544 2565" width="1544.7917px" zoomAndPan="magnify"><defs><linearGradient id="gvmu6re6mu4hg0" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#59B6EC"/><stop offset="100%" stop-color="#2FA4E7"/></linearGradient><linearGradient id="gvmu6re6mu4hg1" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FFFFFF"/><stop offset="100%" stop-color="#F8F9FA"/></linearGradient><linearGradient id="gvmu6re6mu4hg2" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#35638F"/><stop offset="100%" stop-color="#033C73"/></linearGradient></defs><g><rect fill="#90EE90" height="2535.5143" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:1.0416666666666667;" width="185.4167" x="53.125" y="11.4583"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="140.625" x="75.5208" y="28.2694">Native Android app</text><rect fill="#ADD8E6" height="2535.5143" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:1.0416666666666667;" width="1030.2083" x="459.8958" y="11.4583"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="117.7083" x="916.1458" y="28.2694">Android Chrome</text><rect fill="#EDF0F2" height="31.25" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="140.625" y="191.5039"/><rect fill="#EDF0F2" height="1263.6068" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="140.625" y="308.1055"/><rect fill="#EDF0F2" height="334.1146" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="140.625" y="2200.3581"/><rect fill="#EDF0F2" height="2437.6953" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="545.8333" y="106.1523"/><rect fill="#EDF0F2" height="756.7383" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="767.7083" y="646.3542"/><rect fill="#EDF0F2" height="516.3086" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="1067.7083" y="886.7839"/><rect fill="#EDF0F2" height="480.8594" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="1067.7083" y="1679.9479"/><rect fill="#EDF0F2" height="14.5833" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="1359.375" y="725.4557"/><rect height="965.918" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;fill:none;" width="1449.4792" x="46.875" y="445.5078"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;fill:none;stroke-dasharray:5.0,5.0;" x1="145.8333" x2="145.8333" y1="95.7357" y2="2553.2227"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;fill:none;stroke-dasharray:5.0,5.0;" x1="550.5208" x2="550.5208" y1="95.7357" y2="2553.2227"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;fill:none;stroke-dasharray:5.0,5.0;" x1="772.9167" x2="772.9167" y1="95.7357" y2="2553.2227"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;fill:none;stroke-dasharray:5.0,5.0;" x1="1072.9167" x2="1072.9167" y1="95.7357" y2="2553.2227"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;fill:none;stroke-dasharray:5.0,5.0;" x1="1364.0625" x2="1364.0625" y1="95.7357" y2="2553.2227"/><rect fill="url(#gvmu6re6mu4hg0)" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="93.75" x="98.9583" y="55.1432"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="68.75" x="111.4583" y="79.246">Wallet app</text><rect fill="url(#gvmu6re6mu4hg0)" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="90.625" x="505.7292" y="55.1432"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="65.625" x="518.2292" y="79.246">Web dapp</text><rect fill="url(#gvmu6re6mu4hg0)" height="54.1016" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="156.25" x="694.7917" y="40.5924"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="131.25" x="707.2917" y="64.6952">Chrome Custom Tab</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="45.8333" x="750" y="79.246">service</text><rect fill="url(#gvmu6re6mu4hg0)" height="54.1016" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="179.1667" x="983.3333" y="40.5924"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="119.7917" x="1013.0208" y="64.6952">Wallet-hosted web</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="154.1667" x="995.8333" y="79.246">origin attestation script</text><rect fill="url(#gvmu6re6mu4hg0)" height="54.1016" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="159.375" x="1284.8958" y="40.5924"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="134.375" x="1297.3958" y="64.6952">Wallet-hosted Digital</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="65.625" x="1331.7708" y="79.246">Asset Link</text><rect fill="#EDF0F2" height="31.25" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="140.625" y="191.5039"/><rect fill="#EDF0F2" height="1263.6068" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="140.625" y="308.1055"/><rect fill="#EDF0F2" height="334.1146" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="140.625" y="2200.3581"/><rect fill="#EDF0F2" height="2437.6953" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="545.8333" y="106.1523"/><rect fill="#EDF0F2" height="756.7383" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="767.7083" y="646.3542"/><rect fill="#EDF0F2" height="516.3086" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="1067.7083" y="886.7839"/><rect fill="#EDF0F2" height="480.8594" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="1067.7083" y="1679.9479"/><rect fill="#EDF0F2" height="14.5833" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="1359.375" y="725.4557"/><rect fill="url(#gvmu6re6mu4hg1)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#gvmu6re6mu4hg1);stroke-width:1.0416666666666667;" width="1522.3958" x="10.4167" y="132.1777"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="1532.8125" y1="132.1777" y2="132.1777"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="1532.8125" y1="135.3027" y2="135.3027"/><rect fill="url(#gvmu6re6mu4hg1)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="420.8333" x="561.1979" y="116.569"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="391.6667" x="572.6563" y="137.5468">Dapp attempts to authorize with unattested identity</text><polygon fill="#2FA4E7" points="162.5,187.3372,152.0833,191.5039,162.5,195.6706,158.3333,191.5039" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="156.25" x2="544.7917" y1="191.5039" y2="191.5039"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="201.0417" x="173.9583" y="181.2642">Associate (via Local URI Intent)</text><path d="M60.4167,240.4622 L60.4167,266.5039 A4.1667,4.1667 0 0 0 64.5833,270.6706 L631.25,270.6706 A4.1667,4.1667 0 0 0 635.4167,266.5039 L635.4167,246.7122 L625,236.2956 L64.5833,236.2956 A4.1667,4.1667 0 0 0 60.4167,240.4622 " fill="url(#gvmu6re6mu4hg2)" style="stroke:#2683B9;stroke-width:1.0416666666666667;"/><path d="M625,236.2956 L625,244.6289 A2.0833,2.0833 0 0 0 627.0833,246.7122 L635.4167,246.7122 L625,236.2956 " fill="url(#gvmu6re6mu4hg2)" style="stroke:#2683B9;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="298.9583" x="194.0104" y="258.315">Starts after Session Establishment completes</text><polygon fill="#2FA4E7" points="162.5,303.9388,152.0833,308.1055,162.5,312.2721,158.3333,308.1055" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="156.25" x2="544.7917" y1="308.1055" y2="308.1055"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="93.75" x="173.9583" y="297.8658">authorize {...}</text><rect fill="url(#gvmu6re6mu4hg1)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#gvmu6re6mu4hg1);stroke-width:1.0416666666666667;" width="1522.3958" x="10.4167" y="342.4642"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="1532.8125" y1="342.4642" y2="342.4642"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="1532.8125" y1="345.5892" y2="345.5892"/><rect fill="url(#gvmu6re6mu4hg1)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="406.25" x="568.4896" y="326.8555"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="377.0833" x="579.9479" y="347.8333">Bind Wallet to browser with an attestation keypair</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="416.3411" y2="416.3411"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="416.3411" y2="429.8828"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="429.8828" y2="429.8828"/><polygon fill="#2FA4E7" points="162.5,425.7161,152.0833,429.8828,162.5,434.0495,158.3333,429.8828" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="163.5417" y="391.5507">b</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="171.875" x="176.0417" y="391.5507">= Local URI Intent browser</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="117.7083" x="163.5417" y="406.1015">package identifier</text><path d="M51.0417,445.5078 L123.9583,445.5078 L123.9583,462.1419 L113.5417,472.5586 L46.875,472.5586 L46.875,449.6745 A4.1667,4.1667 0 0 1 51.0417,445.5078 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0416666666666667;"/><rect fill="none" height="965.918" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="1449.4792" x="46.875" y="445.5078"/><text fill="#033C73" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="67.7083" y="463.3606">alt</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="254.1667" x="144.7917" y="464.4023">[Wallet has a stored public key for</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="9.375" x="403.125" y="464.4023">b</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="5.2083" x="412.5" y="464.4023">]</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="513.1185" y2="513.1185"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="513.1185" y2="526.6602"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="526.6602" y2="526.6602"/><polygon fill="#2FA4E7" points="162.5,522.4935,152.0833,526.6602,162.5,530.8268,158.3333,526.6602" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="112.5" x="163.5417" y="502.8788">read stored key (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="276.0417" y="502.8788">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="287.5" y="502.8788">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="295.8333" y="502.8788">Q</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="27.0833" x="304.1667" y="502.8788">) for</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="335.4167" y="502.8788">b</text><line style="stroke:#59B6EC;stroke-width:1.0416666666666667;stroke-dasharray:2.0,2.0;" x1="46.875" x2="1496.3542" y1="536.0352" y2="536.0352"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="332.2917" x="57.2917" y="552.8463">[Wallet does not have a stored public key for</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" font-weight="bold" lengthAdjust="spacing" textLength="9.375" x="393.75" y="552.8463">b</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="5.2083" x="403.125" y="552.8463">]</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="593.2617" y2="593.2617"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="593.2617" y2="606.8034"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="164.5833" x2="194.7917" y1="606.8034" y2="606.8034"/><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="157.2917" x2="167.7083" y1="601.5951" y2="612.0117"/><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="157.2917" x2="167.7083" y1="612.0117" y2="601.5951"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="112.5" x="163.5417" y="583.0221">read stored key (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="276.0417" y="583.0221">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="287.5" y="583.0221">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="295.8333" y="583.0221">Q</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="27.0833" x="304.1667" y="583.0221">) for</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="335.4167" y="583.0221">b</text><polygon fill="#2FA4E7" points="755.2083,642.1875,765.625,646.3542,755.2083,650.5208,759.375,646.3542" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="761.4583" y1="646.3542" y2="646.3542"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="205.2083" x="163.5417" y="636.1145">Bind to CCT CustomTabsService</text><polygon fill="#2FA4E7" points="755.2083,681.7383,765.625,685.9049,755.2083,690.0716,759.375,685.9049" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="151.0417" x2="761.4583" y1="685.9049" y2="685.9049"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="152.0833" x="163.5417" y="675.6653">Adopt Wallet app origin</text><polygon fill="#2FA4E7" points="1346.875,721.2891,1357.2917,725.4557,1346.875,729.6224,1351.0417,725.4557" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="778.125" x2="1353.125" y1="725.4557" y2="725.4557"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="213.5417" x="790.625" y="715.2161">Fetch Wallet digital asset link file</text><polygon fill="#2FA4E7" points="789.5833,735.8724,779.1667,740.0391,789.5833,744.2057,785.4167,740.0391" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="783.3333" x2="1363.5417" y1="740.0391" y2="740.0391"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="778.125" x2="821.875" y1="794.1406" y2="794.1406"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="821.875" x2="821.875" y1="794.1406" y2="807.6823"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="779.1667" x2="821.875" y1="807.6823" y2="807.6823"/><polygon fill="#2FA4E7" points="789.5833,803.5156,779.1667,807.6823,789.5833,811.849,785.4167,807.6823" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="236.4583" x="790.625" y="769.3502">Validate native Wallet app signature</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="232.2917" x="790.625" y="783.901">matches digital asset link assertion</text><polygon fill="#2FA4E7" points="755.2083,843.0664,765.625,847.2331,755.2083,851.3997,759.375,847.2331" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="151.0417" x2="761.4583" y1="847.2331" y2="847.2331"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="284.375" x="163.5417" y="836.9934">Navigate to wallet-hosted attestation script</text><polygon fill="#2FA4E7" points="1055.2083,882.6172,1065.625,886.7839,1055.2083,890.9505,1059.375,886.7839" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="778.125" x2="1061.4583" y1="886.7839" y2="886.7839"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="259.375" x="790.625" y="876.5442">Load webpage into Chrome Custom Tab</text><polygon fill="#2FA4E7" points="755.2083,922.168,765.625,926.3346,755.2083,930.5013,759.375,926.3346" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="151.0417" x2="761.4583" y1="926.3346" y2="926.3346"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="317.7083" x="163.5417" y="916.095">Open postMessage channel to attestation script</text><polygon fill="#2FA4E7" points="1055.2083,961.7188,1065.625,965.8854,1055.2083,970.0521,1059.375,965.8854" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="151.0417" x2="1061.4583" y1="965.8854" y2="965.8854"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="337.5" x="163.5417" y="955.6458">postMessage("generate-origin-attestation-keypair")</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1078.125" x2="1121.875" y1="1005.4362" y2="1005.4362"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1121.875" x2="1121.875" y1="1005.4362" y2="1018.9779"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1079.1667" x2="1121.875" y1="1018.9779" y2="1018.9779"/><polygon fill="#2FA4E7" points="1089.5833,1014.8112,1079.1667,1018.9779,1089.5833,1023.1445,1085.4167,1018.9779" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="256.25" x="1090.625" y="995.1965">validate postMessage from same origin</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1078.125" x2="1121.875" y1="1058.5286" y2="1058.5286"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1121.875" x2="1121.875" y1="1058.5286" y2="1072.0703"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1079.1667" x2="1121.875" y1="1072.0703" y2="1072.0703"/><polygon fill="#2FA4E7" points="1089.5833,1067.9036,1079.1667,1072.0703,1089.5833,1076.237,1085.4167,1072.0703" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="167.7083" x="1090.625" y="1048.289">generate ECDSA keypair (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="1258.3333" y="1048.289">Q</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="1266.6667" y="1048.289">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="1275" y="1048.289">d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="1283.3333" y="1048.289">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1078.125" x2="1121.875" y1="1111.6211" y2="1111.6211"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1121.875" x2="1121.875" y1="1111.6211" y2="1125.1628"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1079.1667" x2="1121.875" y1="1125.1628" y2="1125.1628"/><polygon fill="#2FA4E7" points="1089.5833,1120.9961,1079.1667,1125.1628,1089.5833,1129.3294,1085.4167,1125.1628" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="135.4167" x="1090.625" y="1101.3814">generate key unique</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="1230.2083" y="1101.3814">id</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1078.125" x2="1121.875" y1="1164.7135" y2="1164.7135"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1121.875" x2="1121.875" y1="1164.7135" y2="1178.2552"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1079.1667" x2="1121.875" y1="1178.2552" y2="1178.2552"/><polygon fill="#2FA4E7" points="1089.5833,1174.0885,1079.1667,1178.2552,1089.5833,1182.4219,1085.4167,1178.2552" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="40.625" x="1090.625" y="1154.4739">write (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="1131.25" y="1154.4739">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="1142.7083" y="1154.4739">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="1151.0417" y="1154.4739">d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="112.5" x="1159.375" y="1154.4739">) to local storage</text><polygon fill="#2FA4E7" points="162.5,1213.6393,152.0833,1217.806,162.5,1221.9727,158.3333,1217.806" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="156.25" x2="1066.6667" y1="1217.806" y2="1217.806"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="233.3333" x="173.9583" y="1207.5663">postMessage("origin-attestation", {</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="407.2917" y="1207.5663">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="418.75" y="1207.5663">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="427.0833" y="1207.5663">Q</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="13.5417" x="435.4167" y="1207.5663">})</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="1257.3568" y2="1257.3568"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="1257.3568" y2="1270.8984"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="1270.8984" y2="1270.8984"/><polygon fill="#2FA4E7" points="162.5,1266.7318,152.0833,1270.8984,162.5,1275.0651,158.3333,1270.8984" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="256.25" x="163.5417" y="1247.1171">validate postMessage from same origin</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="1310.4492" y2="1310.4492"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="1310.4492" y2="1323.9909"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="1323.9909" y2="1323.9909"/><polygon fill="#2FA4E7" points="162.5,1319.8242,152.0833,1323.9909,162.5,1328.1576,158.3333,1323.9909" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="40.625" x="163.5417" y="1300.2096">write (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="204.1667" y="1300.2096">b</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="212.5" y="1300.2096">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="220.8333" y="1300.2096">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="232.2917" y="1300.2096">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="240.625" y="1300.2096">Q</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="112.5" x="248.9583" y="1300.2096">) to local storage</text><polygon fill="#2FA4E7" points="755.2083,1359.375,765.625,1363.5417,755.2083,1367.7083,759.375,1363.5417" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="761.4583" y1="1363.5417" y2="1363.5417"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="107.2917" x="163.5417" y="1353.302">Unbind from CCT</text><polygon fill="#2FA4E7" points="1060.4167,1398.9258,1070.8333,1403.0924,1060.4167,1407.2591,1064.5833,1403.0924" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="772.9167" x2="1066.6667" y1="1403.0924" y2="1403.0924"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="97.9167" x="785.4167" y="1392.8528">close webpage</text><line style="stroke:#BABDBF;stroke-width:2.0833333333333335;" x1="763.5417" x2="782.2917" y1="1393.7174" y2="1412.4674"/><line style="stroke:#BABDBF;stroke-width:2.0833333333333335;" x1="763.5417" x2="782.2917" y1="1412.4674" y2="1393.7174"/><rect fill="url(#gvmu6re6mu4hg1)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#gvmu6re6mu4hg1);stroke-width:1.0416666666666667;" width="1522.3958" x="10.4167" y="1444.7428"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="1532.8125" y1="1444.7428" y2="1444.7428"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="1532.8125" y1="1447.8678" y2="1447.8678"/><rect fill="url(#gvmu6re6mu4hg1)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="283.3333" x="629.9479" y="1429.1341"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="254.1667" x="641.4063" y="1450.1119">Wallet requests origin attestation</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="1504.069" y2="1504.069"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="1504.069" y2="1517.6107"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="1517.6107" y2="1517.6107"/><polygon fill="#2FA4E7" points="162.5,1513.444,152.0833,1517.6107,162.5,1521.7773,158.3333,1517.6107" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="127.0833" x="163.5417" y="1493.8293">generate a random</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="63.5417" x="294.7917" y="1493.8293">challenge</text><polygon fill="#2FA4E7" points="533.3333,1567.5456,543.75,1571.7122,533.3333,1575.8789,537.5,1571.7122" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="145.8333" x2="539.5833" y1="1571.7122" y2="1571.7122"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="286.4583" x="158.3333" y="1546.9218">response {ERROR_ATTEST_ORIGIN_ANDROID,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="158.3333" y="1561.4726">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="169.7917" y="1561.4726">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="63.5417" x="178.125" y="1561.4726">challenge</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="241.6667" y="1561.4726">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="94.7917" x="250" y="1561.4726">attestation_uri</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="344.7917" y="1561.4726">}</text><rect fill="url(#gvmu6re6mu4hg1)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#gvmu6re6mu4hg1);stroke-width:1.0416666666666667;" width="1522.3958" x="10.4167" y="1606.071"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="1532.8125" y1="1606.071" y2="1606.071"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="1532.8125" y1="1609.196" y2="1609.196"/><rect fill="url(#gvmu6re6mu4hg1)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="535.4167" x="503.9063" y="1590.4622"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="506.25" x="515.3646" y="1611.44">Dapp creates origin attestation token and reattempts authorization</text><polygon fill="#2FA4E7" points="1055.2083,1675.7813,1065.625,1679.9479,1055.2083,1684.1146,1059.375,1679.9479" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="556.25" x2="1061.4583" y1="1679.9479" y2="1679.9479"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="204.1667" x="568.75" y="1655.1575">create invisible iframe and load</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="205.2083" x="568.75" y="1669.7083">wallet-hosted attestation script</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="556.25" x2="600" y1="1734.0495" y2="1734.0495"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="600" x2="600" y1="1734.0495" y2="1747.5911"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="557.2917" x2="600" y1="1747.5911" y2="1747.5911"/><polygon fill="#2FA4E7" points="567.7083,1743.4245,557.2917,1747.5911,567.7083,1751.7578,563.5417,1747.5911" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="568.75" y="1709.259">h</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="173.9583" x="581.25" y="1709.259">= SHA256("attest-origin" ||</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="63.5417" x="568.75" y="1723.8098">challenge</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="636.4583" y="1723.8098">||</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="93.75" x="648.9583" y="1723.8098">session_secret</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="742.7083" y="1723.8098">)</text><polygon fill="#2FA4E7" points="1055.2083,1782.9753,1065.625,1787.1419,1055.2083,1791.3086,1059.375,1787.1419" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="556.25" x2="1061.4583" y1="1787.1419" y2="1787.1419"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="568.75" y="1776.9023">postMessage(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="661.4583" y="1776.9023">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="672.9167" y="1776.9023">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="681.25" y="1776.9023">h</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="689.5833" y="1776.9023">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1078.125" x2="1121.875" y1="1826.6927" y2="1826.6927"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1121.875" x2="1121.875" y1="1826.6927" y2="1840.2344"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1079.1667" x2="1121.875" y1="1840.2344" y2="1840.2344"/><polygon fill="#2FA4E7" points="1089.5833,1836.0677,1079.1667,1840.2344,1089.5833,1844.401,1085.4167,1840.2344" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="1090.625" y="1816.453">o</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="159.375" x="1103.125" y="1816.453">= origin of postMessage</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1078.125" x2="1121.875" y1="1879.7852" y2="1879.7852"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1121.875" x2="1121.875" y1="1879.7852" y2="1893.3268"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1079.1667" x2="1121.875" y1="1893.3268" y2="1893.3268"/><polygon fill="#2FA4E7" points="1089.5833,1889.1602,1079.1667,1893.3268,1089.5833,1897.4935,1085.4167,1893.3268" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="39.5833" x="1090.625" y="1869.5455">read (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="1130.2083" y="1869.5455">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="1141.6667" y="1869.5455">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="1150" y="1869.5455">d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="128.125" x="1158.3333" y="1869.5455">) from local storage</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1078.125" x2="1121.875" y1="1947.4284" y2="1947.4284"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1121.875" x2="1121.875" y1="1947.4284" y2="1960.9701"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1079.1667" x2="1121.875" y1="1960.9701" y2="1960.9701"/><polygon fill="#2FA4E7" points="1089.5833,1956.8034,1079.1667,1960.9701,1089.5833,1965.1367,1085.4167,1960.9701" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="183.3333" x="1090.625" y="1922.6379">create attestation message</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="1090.625" y="1937.1887">m</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="22.9167" x="1106.25" y="1937.1887">= {</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="1129.1667" y="1937.1887">o</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="1137.5" y="1937.1887">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="1145.8333" y="1937.1887">h</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="1154.1667" y="1937.1887">}</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1078.125" x2="1121.875" y1="2000.5208" y2="2000.5208"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1121.875" x2="1121.875" y1="2000.5208" y2="2014.0625"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="1079.1667" x2="1121.875" y1="2014.0625" y2="2014.0625"/><polygon fill="#2FA4E7" points="1089.5833,2009.8958,1079.1667,2014.0625,1089.5833,2018.2292,1085.4167,2014.0625" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="106.25" x="1090.625" y="1990.2812">S = ECDSA-sign(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="1196.875" y="1990.2812">d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="1205.2083" y="1990.2812">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="1213.5417" y="1990.2812">m</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="1225" y="1990.2812">)</text><polygon fill="#2FA4E7" points="567.7083,2049.4466,557.2917,2053.6133,567.7083,2057.7799,563.5417,2053.6133" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="561.4583" x2="1066.6667" y1="2053.6133" y2="2053.6133"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="92.7083" x="579.1667" y="2043.3736">postMessage(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="671.875" y="2043.3736">m</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="683.3333" y="2043.3736">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="691.6667" y="2043.3736">S</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="700" y="2043.3736">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="556.25" x2="600" y1="2107.7148" y2="2107.7148"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="600" x2="600" y1="2107.7148" y2="2121.2565"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="557.2917" x2="600" y1="2121.2565" y2="2121.2565"/><polygon fill="#2FA4E7" points="567.7083,2117.0898,557.2917,2121.2565,567.7083,2125.4232,563.5417,2121.2565" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="176.0417" x="568.75" y="2082.9244">validate postMessage from</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="120.8333" x="568.75" y="2097.4752">attest script origin</text><polygon fill="#2FA4E7" points="1060.4167,2156.6406,1070.8333,2160.8073,1060.4167,2164.974,1064.5833,2160.8073" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="556.25" x2="1066.6667" y1="2160.8073" y2="2160.8073"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="148.9583" x="568.75" y="2150.5676">destroy invisible iframe</text><polygon fill="#2FA4E7" points="162.5,2196.1914,152.0833,2200.3581,162.5,2204.5247,158.3333,2200.3581" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="156.25" x2="544.7917" y1="2200.3581" y2="2200.3581"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="89.5833" x="173.9583" y="2190.1184">authorize {...,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="267.7083" y="2190.1184">m</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="279.1667" y="2190.1184">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="287.5" y="2190.1184">S</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="295.8333" y="2190.1184">}</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="2239.9089" y2="2239.9089"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="2239.9089" y2="2253.4505"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="2253.4505" y2="2253.4505"/><polygon fill="#2FA4E7" points="162.5,2249.2839,152.0833,2253.4505,162.5,2257.6172,158.3333,2253.4505" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="112.5" x="163.5417" y="2229.6692">read stored key (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="276.0417" y="2229.6692">id</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="287.5" y="2229.6692">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="295.8333" y="2229.6692">Q</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="27.0833" x="304.1667" y="2229.6692">) for</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="335.4167" y="2229.6692">b</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="2307.5521" y2="2307.5521"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="2307.5521" y2="2321.0938"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="2321.0938" y2="2321.0938"/><polygon fill="#2FA4E7" points="162.5,2316.9271,152.0833,2321.0938,162.5,2325.2604,158.3333,2321.0938" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="117.7083" x="163.5417" y="2282.7616">validate signature</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="85.4167" x="163.5417" y="2297.3124">ECDSA-verify(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="248.9583" y="2297.3124">Q</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="257.2917" y="2297.3124">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="265.625" y="2297.3124">m</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="277.0833" y="2297.3124">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="285.4167" y="2297.3124">S</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="293.75" y="2297.3124">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="2375.1953" y2="2375.1953"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="2375.1953" y2="2388.737"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="2388.737" y2="2388.737"/><polygon fill="#2FA4E7" points="162.5,2384.5703,152.0833,2388.737,162.5,2392.9036,158.3333,2388.737" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="82.2917" x="163.5417" y="2350.4049">validate that</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="250" y="2350.4049">m</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="56.25" x="265.625" y="2350.4049">contains</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="326.0417" y="2350.4049">h</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="163.5417" y="2364.9556">h</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="173.9583" x="176.0417" y="2364.9556">= SHA256("attest-origin" ||</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="63.5417" x="354.1667" y="2364.9556">challenge</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="421.875" y="2364.9556">||</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="93.75" x="434.375" y="2364.9556">session_secret</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="528.125" y="2364.9556">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="2428.2878" y2="2428.2878"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="2428.2878" y2="2441.8294"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="2441.8294" y2="2441.8294"/><polygon fill="#2FA4E7" points="162.5,2437.6628,152.0833,2441.8294,162.5,2445.9961,158.3333,2441.8294" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="213.5417" x="163.5417" y="2418.0481">validate identity is valid for origin</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="381.25" y="2418.0481">o</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="151.0417" x2="194.7917" y1="2481.3802" y2="2481.3802"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="194.7917" x2="194.7917" y1="2481.3802" y2="2494.9219"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="152.0833" x2="194.7917" y1="2494.9219" y2="2494.9219"/><polygon fill="#2FA4E7" points="162.5,2490.7552,152.0833,2494.9219,162.5,2499.0885,158.3333,2494.9219" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="118.75" x="163.5417" y="2471.1405">create auth token</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="286.4583" y="2471.1405">at</text><polygon fill="#2FA4E7" points="533.3333,2530.306,543.75,2534.4727,533.3333,2538.6393,537.5,2534.4727" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="145.8333" x2="539.5833" y1="2534.4727" y2="2534.4727"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="73.9583" x="158.3333" y="2524.233">response {</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="232.2917" y="2524.233">at</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="245.8333" y="2524.233">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="16.6667" x="254.1667" y="2524.233">uri</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="270.8333" y="2524.233">}</text><!--MD5=[895576564f145ac07e575deda2eea609]
@startuml

!theme cerulean
skinparam backgroundColor #FFFFFF

hide footbox

box "Native Android app" #LightGreen
participant wallet as "Wallet app"
end box
box "Android Chrome" #LightBlue
participant dapp as "Web dapp"
participant cct as "Chrome Custom Tab\nservice"
participant attest as "Wallet-hosted web\norigin attestation script"
participant dal as "Wallet-hosted Digital\nAsset Link"
end box

== Dapp attempts to authorize with unattested identity ==

activate dapp
dapp -> wallet ++ : Associate (via Local URI Intent)
deactivate wallet
note over wallet, dapp : Starts after Session Establishment completes
dapp -> wallet ++ : authorize {...}

== Bind Wallet to browser with an attestation keypair ==

wallet -> wallet : <i>b</i> = Local URI Intent browser\npackage identifier
alt Wallet has a stored public key for <i>b</i>
    wallet -> wallet : read stored key (<i>id</i>, <i>Q</i>) for <i>b</i>
else Wallet does not have a stored public key for <i>b</i>
    wallet -X wallet : read stored key (<i>id</i>, <i>Q</i>) for <i>b</i>
    wallet -> cct ++: Bind to CCT CustomTabsService
    wallet - -> cct : Adopt Wallet app origin
    cct -> dal ++ : Fetch Wallet digital asset link file
    return
    cct -> cct : Validate native Wallet app signature\nmatches digital asset link assertion
    wallet - -> cct : Navigate to wallet-hosted attestation script
    cct - -> attest ++ : Load webpage into Chrome Custom Tab
    wallet - -> cct : Open postMessage channel to attestation script
    wallet - -> attest : postMessage("generate-origin-attestation-keypair")
    attest -> attest : validate postMessage from same origin
    attest -> attest : generate ECDSA keypair (<i>Q</i>, <i>d</i>)
    attest -> attest : generate key unique <i>id</i>
    attest -> attest : write (<i>id</i>, <i>d</i>) to local storage
    attest - -> wallet : postMessage("origin-attestation", {<i>id</i>, <i>Q</i>})
    wallet -> wallet : validate postMessage from same origin
    wallet -> wallet : write (<i>b</i>, <i>id</i>, <i>Q</i>) to local storage
    wallet -> cct : Unbind from CCT
    cct - -> attest : close webpage
    deactivate attest
    destroy cct
end

== Wallet requests origin attestation ==

wallet -> wallet : generate a random <i>challenge</i>
wallet - -> dapp - - : response {ERROR_ATTEST_ORIGIN_ANDROID,\n<i>id</i>, <i>challenge</i>, <i>attestation_uri</i>}

== Dapp creates origin attestation token and reattempts authorization ==

dapp -> attest ++ : create invisible iframe and load\nwallet-hosted attestation script
dapp -> dapp : <i>h</i> = SHA256("attest-origin" ||\n<i>challenge</i> || <i>session_secret</i>)
dapp - -> attest : postMessage(<i>id</i>, <i>h</i>)
attest -> attest : <i>o</i> = origin of postMessage
attest -> attest : read (<i>id</i>, <i>d</i>) from local storage
attest -> attest : create attestation message\n<i>m</i> = {<i>o</i>, <i>h</i>}
attest -> attest : S = ECDSA-sign(<i>d</i>, <i>m</i>)
attest - -> dapp : postMessage(<i>m</i>, <i>S</i>)
dapp -> dapp : validate postMessage from\nattest script origin
dapp -> attest : destroy invisible iframe
deactivate attest
dapp -> wallet ++ : authorize {..., <i>m</i>, <i>S</i>}
wallet -> wallet : read stored key (<i>id</i>, <i>Q</i>) for <i>b</i>
wallet -> wallet : validate signature\nECDSA-verify(<i>Q</i>, <i>m</i>, <i>S</i>)
wallet -> wallet : validate that <i>m</i> contains <i>h</i>\n<i>h</i> = SHA256("attest-origin" || <i>challenge</i> || <i>session_secret</i>)
wallet -> wallet : validate identity is valid for origin <i>o</i>
wallet -> wallet : create auth token <i>at</i>
wallet - -> dapp - - : response {<i>at</i>, <i>uri</i>}

@enduml

@startuml




skinparam backgroundColor transparent
skinparam useBetaStyle false






<style>
  root {
    BackgroundColor transparent
    FontColor #FFF
    HyperLinkColor #FD7E14
    LineColor #2683B9
    LineThickness 1
    Margin 10
    Padding 6
    Shadowing 0.0
  }
  node {
   Padding 15
   roundcorner 20
   BackgroundColor #2FA4E7-#2683B9
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  groupHeader {
    BackgroundColor #E9ECEF
    FontColor #033C73
    FontStyle bold
  }
  header {
    LineThickness 0
  }
  referenceHeader {
    BackgroundColor transparent
    FontColor #343A40
    FontStyle bold
  }
  separator {
    BackgroundColor #343A40
    FontColor transparent
    FontStyle bold
  }
  title {
	FontSize 20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor  #EDF0F2-#E9ECEF
	FontColor #2FA4E7
	BorderColor #E9ECEF
  }
  nwdiagDiagram {
	network {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7    
		LineColor #2FA4E7
		LineThickness 1.0
		FontColor #2683B9
	}
	server {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	}
	arrow {
		FontColor #2683B9
		LineColor #2683B9
	}
	group {
		BackGroundColor #F8F9FA
		LineColor $LIGHT_DARK
		LineThickness 2.0
		Margin 5
		Padding 5
	}
  }
  ganttDiagram {
	task {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
		LineColor #2FA4E7
		Margin 10
		Padding 6
	}
	note {
		FontColor #FFF
		LineColor #02305C
		BackGroundColor #033C73
	}
	separator {
		LineColor #E9ECEF
		BackGroundColor #E9ECEF-#BABDBF
		FontColor #343A40
	}
	milestone {
		FontColor #033C73
		FontSize 16
		FontStyle italic
		BackGroundColor #E9ECEF
		LineColor #BABDBF
	}
	timeline {
		BackgroundColor #E9ECEF
		FontColor #343A40
	}
	closed {
		BackgroundColor #B14500
		FontColor #FFF
	}
  }
</style>
skinparam defaultFontName        "Verdana"
skinparam defaultFontSize        12
skinparam dpi                    100
skinparam shadowing              false
skinparam roundcorner            8
skinparam ParticipantPadding     40
skinparam BoxPadding             40
skinparam Padding                5
skinparam ArrowColor             #868E96
skinparam stereotype {
    CBackgroundColor #EDF0F2
    CBorderColor #BABDBF
    ABackgroundColor #8FB961
    ABorderColor #5C862E
    IBackgroundColor #D2494E
    IBorderColor #9F161B
    EBackgroundColor #E47833
    EBorderColor #B14500
    NBackgroundColor #35638F
    NBorderColor #02305C
}
skinparam title {
	FontColor	                 #2FA4E7
	BorderColor	                 #BABDBF
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              #EDF0F2-#E9ECEF
}


skinparam legend {
	BackgroundColor #E9ECEF
	BorderColor #BABDBF
	FontColor #343A40
}

skinparam swimlane {
	BorderColor #033C73
	BorderThickness 2
	TitleBackgroundColor  #EDF0F2-#E9ECEF
	TitleFontColor #2FA4E7
}


skinparam activity {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BarColor #73A839
	StartColor #033C73
	EndColor #033C73
	DiamondBackgroundColor #FFF-#EDF0F2
  	DiamondBorderColor #BABDBF
	DiamondFontColor #343A40
}


skinparam participant {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	ParticipantBorderThickness 2
}


skinparam actor {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam arrow {
	Thickness 3
	Color #2FA4E7
	FontColor #343A40
}


skinparam sequence {
	BorderColor #2FA4E7
	TitleFontColor #2FA4E7
	BackgroundColor transparent
	StartColor #2FA4E7
	EndColor #2FA4E7
	BoxBackgroundColor #F8F9FA
	BoxBorderColor #868E96
	BoxFontColor #343A40
	DelayFontColor #343A40
	LifeLineBorderColor #BABDBF
	LifeLineBorderThickness 2
	LifeLineBackgroundColor #EDF0F2
	GroupBorderColor #868E96
	GroupFontColor #343A40
	GroupHeaderFontColor #033C73
	DividerBackgroundColor #FFF-#F8F9FA
    DividerBorderColor #868E96
    DividerBorderThickness 2
    DividerFontColor #343A40
	ReferenceBackgroundColor transparent
	ReferenceBorderColor #868E96
	ReferenceFontColor #343A40
	ReferenceHeaderFontColor #033C73
	StereotypeFontColor #FFF
}


skinparam partition {
	BorderColor #2FA4E7
	FontColor #2FA4E7
	BackgroundColor transparent
}


skinparam collections {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam control {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam entity {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam boundary {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam agent {
	BackgroundColor #orange
	BorderColor #999999
	FontColor #333333
}


skinparam note {
	BorderThickness 1
	BackgroundColor #35638F-#033C73
	BorderColor #033C73
	FontColor #FFF
}


skinparam artifact {
	BackgroundColor #FFF-#F8F9FA
	BorderColor #BABDBF
	FontColor #343A40
}


skinparam component {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam interface {
	BackgroundColor  #D2494E
	BorderColor  #C71C22
	FontColor #343A40
}


skinparam storage {
	BackgroundColor #E47833-#DD5600
  	BorderColor #DD5600
	FontColor #FFF
}


skinparam node {
	BackgroundColor #EDF0F2-#E9ECEF
	BorderColor #E9ECEF
	FontColor #343A40
}


skinparam cloud {
	BackgroundColor #F2FCFE-#eeeeee
	BorderColor #F2FCFE
	FontColor #2FA4E7
}


skinparam database {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam class {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	HeaderBackgroundColor #2FA4E7-#2683B9
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #F8F9FA
	AttributeFontSize 11
}


skinparam object {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam usecase {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam rectangle {
	FontColor #2FA4E7
	BorderColor #59B6EC
	BackgroundColor transparent
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam package {
	FontColor #2FA4E7
	BorderColor #59B6EC
	BackgroundColor transparent
	BorderThickness 2
}


skinparam folder {
	BackgroundColor #FFF-#EDF0F2
  	BorderColor #DD5600
	FontColor #DD5600
	BorderThickness 2
}


skinparam frame {
	BackgroundColor #FFF-#EDF0F2
  	BorderColor #033C73
	FontColor #033C73
	BorderThickness 2
}


skinparam state {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BorderColor #2683B9
	StartColor #033C73
	EndColor #033C73
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam queue {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam card {
	BackgroundColor #35638F-#033C73
	BorderColor #033C73
	FontColor #FFF
}


skinparam file {
	BackgroundColor #EDF0F2-#E9ECEF
	BorderColor #033C73
	FontColor #868E96

}


skinparam stack {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}
skinparam backgroundColor #FFFFFF

hide footbox

box "Native Android app" #LightGreen
participant wallet as "Wallet app"
end box
box "Android Chrome" #LightBlue
participant dapp as "Web dapp"
participant cct as "Chrome Custom Tab\nservice"
participant attest as "Wallet-hosted web\norigin attestation script"
participant dal as "Wallet-hosted Digital\nAsset Link"
end box

== Dapp attempts to authorize with unattested identity ==

activate dapp
dapp -> wallet ++ : Associate (via Local URI Intent)
deactivate wallet
note over wallet, dapp : Starts after Session Establishment completes
dapp -> wallet ++ : authorize {...}

== Bind Wallet to browser with an attestation keypair ==

wallet -> wallet : <i>b</i> = Local URI Intent browser\npackage identifier
alt Wallet has a stored public key for <i>b</i>
    wallet -> wallet : read stored key (<i>id</i>, <i>Q</i>) for <i>b</i>
else Wallet does not have a stored public key for <i>b</i>
    wallet -X wallet : read stored key (<i>id</i>, <i>Q</i>) for <i>b</i>
    wallet -> cct ++: Bind to CCT CustomTabsService
    wallet - -> cct : Adopt Wallet app origin
    cct -> dal ++ : Fetch Wallet digital asset link file
    return
    cct -> cct : Validate native Wallet app signature\nmatches digital asset link assertion
    wallet - -> cct : Navigate to wallet-hosted attestation script
    cct - -> attest ++ : Load webpage into Chrome Custom Tab
    wallet - -> cct : Open postMessage channel to attestation script
    wallet - -> attest : postMessage("generate-origin-attestation-keypair")
    attest -> attest : validate postMessage from same origin
    attest -> attest : generate ECDSA keypair (<i>Q</i>, <i>d</i>)
    attest -> attest : generate key unique <i>id</i>
    attest -> attest : write (<i>id</i>, <i>d</i>) to local storage
    attest - -> wallet : postMessage("origin-attestation", {<i>id</i>, <i>Q</i>})
    wallet -> wallet : validate postMessage from same origin
    wallet -> wallet : write (<i>b</i>, <i>id</i>, <i>Q</i>) to local storage
    wallet -> cct : Unbind from CCT
    cct - -> attest : close webpage
    deactivate attest
    destroy cct
end

== Wallet requests origin attestation ==

wallet -> wallet : generate a random <i>challenge</i>
wallet - -> dapp - - : response {ERROR_ATTEST_ORIGIN_ANDROID,\n<i>id</i>, <i>challenge</i>, <i>attestation_uri</i>}

== Dapp creates origin attestation token and reattempts authorization ==

dapp -> attest ++ : create invisible iframe and load\nwallet-hosted attestation script
dapp -> dapp : <i>h</i> = SHA256("attest-origin" ||\n<i>challenge</i> || <i>session_secret</i>)
dapp - -> attest : postMessage(<i>id</i>, <i>h</i>)
attest -> attest : <i>o</i> = origin of postMessage
attest -> attest : read (<i>id</i>, <i>d</i>) from local storage
attest -> attest : create attestation message\n<i>m</i> = {<i>o</i>, <i>h</i>}
attest -> attest : S = ECDSA-sign(<i>d</i>, <i>m</i>)
attest - -> dapp : postMessage(<i>m</i>, <i>S</i>)
dapp -> dapp : validate postMessage from\nattest script origin
dapp -> attest : destroy invisible iframe
deactivate attest
dapp -> wallet ++ : authorize {..., <i>m</i>, <i>S</i>}
wallet -> wallet : read stored key (<i>id</i>, <i>Q</i>) for <i>b</i>
wallet -> wallet : validate signature\nECDSA-verify(<i>Q</i>, <i>m</i>, <i>S</i>)
wallet -> wallet : validate that <i>m</i> contains <i>h</i>\n<i>h</i> = SHA256("attest-origin" || <i>challenge</i> || <i>session_secret</i>)
wallet -> wallet : validate identity is valid for origin <i>o</i>
wallet -> wallet : create auth token <i>at</i>
wallet - -> dapp - - : response {<i>at</i>, <i>uri</i>}

@enduml

PlantUML version 1.2022.6(Tue Jun 21 17:34:49 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>