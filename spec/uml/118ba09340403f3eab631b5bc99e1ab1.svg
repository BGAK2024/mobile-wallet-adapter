<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1843.75px" preserveAspectRatio="none" style="width:978px;height:1843px;background:#FFFFFF;" version="1.1" viewBox="0 0 978 1843" width="978.125px" zoomAndPan="magnify"><defs><linearGradient id="g1ftdxjd0shnff0" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#59B6EC"/><stop offset="100%" stop-color="#2FA4E7"/></linearGradient><linearGradient id="g1ftdxjd0shnff1" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#35638F"/><stop offset="100%" stop-color="#033C73"/></linearGradient><linearGradient id="g1ftdxjd0shnff2" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FFFFFF"/><stop offset="100%" stop-color="#F8F9FA"/></linearGradient></defs><g><rect fill="#EDF0F2" height="268.5872" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="335.9375" y="75.9766"/><rect fill="#EDF0F2" height="209.2773" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="335.9375" y="437.207"/><rect fill="#EDF0F2" height="209.2773" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="335.9375" y="963.9323"/><rect fill="#EDF0F2" height="124.9349" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="335.9375" y="1386.5885"/><rect fill="#EDF0F2" height="155.1432" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="572.3958" y="313.3138"/><rect fill="#EDF0F2" height="379.9479" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="572.3958" y="615.2344"/><rect fill="#EDF0F2" height="275.8789" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="572.3958" y="1141.9596"/><rect height="89.4857" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;fill:none;" width="462.5" x="493.2292" y="835.9375"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;fill:none;stroke-dasharray:5.0,5.0;" x1="179.1667" x2="179.1667" y1="1523.5026" y2="1610.4167"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;fill:none;stroke-dasharray:5.0,5.0;" x1="340.625" x2="340.625" y1="65.5599" y2="1610.4167"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;fill:none;stroke-dasharray:5.0,5.0;" x1="577.6042" x2="577.6042" y1="65.5599" y2="1610.4167"/><rect fill="url(#g1ftdxjd0shnff0)" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="59.375" x="311.4583" y="24.9674"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="34.375" x="323.9583" y="49.0702">Dapp</text><rect fill="url(#g1ftdxjd0shnff0)" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="64.5833" x="545.3125" y="24.9674"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="39.5833" x="557.8125" y="49.0702">Wallet</text><rect fill="#EDF0F2" height="268.5872" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="335.9375" y="75.9766"/><rect fill="#EDF0F2" height="209.2773" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="335.9375" y="437.207"/><rect fill="#EDF0F2" height="209.2773" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="335.9375" y="963.9323"/><rect fill="#EDF0F2" height="124.9349" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="335.9375" y="1386.5885"/><rect fill="#EDF0F2" height="155.1432" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="572.3958" y="313.3138"/><rect fill="#EDF0F2" height="379.9479" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="572.3958" y="615.2344"/><rect fill="#EDF0F2" height="275.8789" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="572.3958" y="1141.9596"/><path d="M15.625,85.3516 L15.625,111.3932 A4.1667,4.1667 0 0 0 19.7917,115.5599 L738.5417,115.5599 A4.1667,4.1667 0 0 0 742.7083,111.3932 L742.7083,91.6016 L732.2917,81.1849 L19.7917,81.1849 A4.1667,4.1667 0 0 0 15.625,85.3516 " fill="url(#g1ftdxjd0shnff1)" style="stroke:#2683B9;stroke-width:1.0416666666666667;"/><path d="M732.2917,81.1849 L732.2917,89.5182 A2.0833,2.0833 0 0 0 734.375,91.6016 L742.7083,91.6016 L732.2917,81.1849 " fill="url(#g1ftdxjd0shnff1)" style="stroke:#2683B9;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="694.7917" x="27.0833" y="103.2043">Dapp has established a session with Wallet for transaction signing using a previously obtained auth token</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="346.3542" x2="390.1042" y1="152.9948" y2="152.9948"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="390.1042" x2="390.1042" y1="152.9948" y2="166.5365"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="347.3958" x2="390.1042" y1="166.5365" y2="166.5365"/><polygon fill="#2FA4E7" points="357.8125,162.3698,347.3958,166.5365,357.8125,170.7031,353.6458,166.5365" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="358.8542" y="142.7551">at</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="372.3958" y="142.7551">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="380.7292" y="142.7551">pub</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="56.25" x="409.8958" y="142.7551">= Load()</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="346.3542" x2="390.1042" y1="206.0872" y2="206.0872"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="390.1042" x2="390.1042" y1="206.0872" y2="219.6289"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="347.3958" x2="390.1042" y1="219.6289" y2="219.6289"/><polygon fill="#2FA4E7" points="357.8125,215.4622,347.3958,219.6289,357.8125,223.7956,353.6458,219.6289" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="5.2083" x="358.8542" y="195.8476">t</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="140.625" x="368.2292" y="195.8476">= CreateTransaction(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="508.8542" y="195.8476">pub</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="26.0417" x="533.8542" y="195.8476">, ...)</text><rect fill="url(#g1ftdxjd0shnff2)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#g1ftdxjd0shnff2);stroke-width:1.0416666666666667;" width="955.7292" x="10.4167" y="253.9876"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="253.9876" y2="253.9876"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="257.1126" y2="257.1126"/><rect fill="url(#g1ftdxjd0shnff2)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="341.6667" x="317.4479" y="238.3789"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="312.5" x="328.9063" y="259.3567">Submit for signing with cached auth token</text><polygon fill="#2FA4E7" points="559.8958,309.1471,570.3125,313.3138,559.8958,317.4805,564.0625,313.3138" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="346.3542" x2="566.1458" y1="313.3138" y2="313.3138"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="120.8333" x="358.8542" y="303.0741">sign_transaction {</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="479.6875" y="303.0741">at</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="493.2292" y="303.0741">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="5.2083" x="501.5625" y="303.0741">t</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="506.7708" y="303.0741">}</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="582.8125" x2="626.5625" y1="384.1146" y2="384.1146"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="626.5625" x2="626.5625" y1="384.1146" y2="397.6563"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="596.3542" x2="626.5625" y1="397.6563" y2="397.6563"/><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="589.0625" x2="599.4792" y1="392.4479" y2="402.8646"/><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="589.0625" x2="599.4792" y1="402.8646" y2="392.4479"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="127.0833" x="595.3125" y="373.8749">validate auth token</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="726.5625" y="373.8749">at</text><polygon fill="#2FA4E7" points="357.8125,433.0404,347.3958,437.207,357.8125,441.3737,353.6458,437.207" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="351.5625" x2="571.3542" y1="437.207" y2="437.207"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="191.6667" x="369.2708" y="426.9674">error {ERROR_REAUTHORIZE}</text><rect fill="url(#g1ftdxjd0shnff2)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#g1ftdxjd0shnff2);stroke-width:1.0416666666666667;" width="955.7292" x="10.4167" y="502.8158"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="502.8158" y2="502.8158"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="505.9408" y2="505.9408"/><rect fill="url(#g1ftdxjd0shnff2)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="119.7917" x="428.3854" y="487.207"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="90.625" x="439.8438" y="508.1848">Reauthorize</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="346.3542" x2="390.1042" y1="562.1419" y2="562.1419"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="390.1042" x2="390.1042" y1="562.1419" y2="575.6836"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="347.3958" x2="390.1042" y1="575.6836" y2="575.6836"/><polygon fill="#2FA4E7" points="357.8125,571.5169,347.3958,575.6836,357.8125,579.8503,353.6458,575.6836" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="3.125" x="358.8542" y="551.9023">i</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="107.2917" x="366.1458" y="551.9023">= DappIdentity()</text><polygon fill="#2FA4E7" points="559.8958,611.0677,570.3125,615.2344,559.8958,619.401,564.0625,615.2344" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="346.3542" x2="566.1458" y1="615.2344" y2="615.2344"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="86.4583" x="358.8542" y="604.9947">reauthorize {</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="3.125" x="445.3125" y="604.9947">i</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="448.4375" y="604.9947">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="456.7708" y="604.9947">at</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="470.3125" y="604.9947">}</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="582.8125" x2="626.5625" y1="686.0352" y2="686.0352"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="626.5625" x2="626.5625" y1="686.0352" y2="699.5768"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="583.8542" x2="626.5625" y1="699.5768" y2="699.5768"/><polygon fill="#2FA4E7" points="594.2708,695.4102,583.8542,699.5768,594.2708,703.7435,590.1042,699.5768" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="141.6667" x="595.3125" y="675.7955">validate Dapp identity</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="3.125" x="741.1458" y="675.7955">i</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="56.25" x="748.4375" y="675.7955">matches</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="808.8542" y="675.7955">at</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="582.8125" x2="626.5625" y1="753.6784" y2="753.6784"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="626.5625" x2="626.5625" y1="753.6784" y2="767.2201"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="583.8542" x2="626.5625" y1="767.2201" y2="767.2201"/><polygon fill="#2FA4E7" points="594.2708,763.0534,583.8542,767.2201,594.2708,771.3867,590.1042,767.2201" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="167.7083" x="595.3125" y="728.8879">Generate new auth token</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="21.875" x="595.3125" y="743.4387">at2</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="166.6667" x="621.3542" y="743.4387">= RegenerateAuthToken(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="3.125" x="788.0208" y="743.4387">i</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="791.1458" y="743.4387">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="799.4792" y="743.4387">at</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="813.0208" y="743.4387">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="582.8125" x2="626.5625" y1="806.7708" y2="806.7708"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="626.5625" x2="626.5625" y1="806.7708" y2="820.3125"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="583.8542" x2="626.5625" y1="820.3125" y2="820.3125"/><polygon fill="#2FA4E7" points="594.2708,816.1458,583.8542,820.3125,594.2708,824.4792,590.1042,820.3125" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="595.3125" y="796.5312">pub</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="216.6667" x="624.4792" y="796.5312">= base58encode(GetPublicKey())</text><path d="M497.3958,835.9375 L570.3125,835.9375 L570.3125,852.5716 L559.8958,862.9883 L493.2292,862.9883 L493.2292,840.1042 A4.1667,4.1667 0 0 1 497.3958,835.9375 " fill="#E9ECEF" style="stroke:#868E96;stroke-width:1.0416666666666667;"/><rect fill="none" height="89.4857" rx="4.1667" ry="4.1667" style="stroke:#59B6EC;stroke-width:1.0416666666666667;" width="462.5" x="493.2292" y="835.9375"/><text fill="#033C73" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="19.7917" x="514.0625" y="853.7903">alt</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="354.1667" x="591.1458" y="854.8319">[if wallet endpoint has an endpoint-specific URI]</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="582.8125" x2="626.5625" y1="903.5482" y2="903.5482"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="626.5625" x2="626.5625" y1="903.5482" y2="917.0898"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="583.8542" x2="626.5625" y1="917.0898" y2="917.0898"/><polygon fill="#2FA4E7" points="594.2708,912.9232,583.8542,917.0898,594.2708,921.2565,590.1042,917.0898" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="16.6667" x="595.3125" y="893.3085">uri</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="136.4583" x="616.1458" y="893.3085">= EndpointBaseURI()</text><polygon fill="#2FA4E7" points="357.8125,959.7656,347.3958,963.9323,357.8125,968.099,353.6458,963.9323" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="351.5625" x2="571.3542" y1="963.9323" y2="963.9323"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="66.6667" x="369.2708" y="953.6926">response(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="21.875" x="435.9375" y="953.6926">at2</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="457.8125" y="953.6926">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="466.1458" y="953.6926">pub</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="491.1458" y="953.6926">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="16.6667" x="499.4792" y="953.6926">uri</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="516.1458" y="953.6926">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="346.3542" x2="390.1042" y1="1034.7331" y2="1034.7331"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="390.1042" x2="390.1042" y1="1034.7331" y2="1048.2747"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="347.3958" x2="390.1042" y1="1048.2747" y2="1048.2747"/><polygon fill="#2FA4E7" points="357.8125,1044.1081,347.3958,1048.2747,357.8125,1052.4414,353.6458,1048.2747" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="40.625" x="358.8542" y="1024.4934">Store(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="21.875" x="399.4792" y="1024.4934">at2</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="421.3542" y="1024.4934">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="429.6875" y="1024.4934">pub</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="454.6875" y="1024.4934">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="16.6667" x="463.0208" y="1024.4934">uri</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="479.6875" y="1024.4934">)</text><rect fill="url(#g1ftdxjd0shnff2)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#g1ftdxjd0shnff2);stroke-width:1.0416666666666667;" width="955.7292" x="10.4167" y="1082.6335"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="1082.6335" y2="1082.6335"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="1085.7585" y2="1085.7585"/><rect fill="url(#g1ftdxjd0shnff2)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="338.5417" x="319.0104" y="1067.0247"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="309.375" x="330.4688" y="1088.0025">Resubmit for signing with new auth token</text><polygon fill="#2FA4E7" points="559.8958,1137.793,570.3125,1141.9596,559.8958,1146.1263,564.0625,1141.9596" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="346.3542" x2="566.1458" y1="1141.9596" y2="1141.9596"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="113.5417" x="358.8542" y="1131.72">sign_transaction(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="21.875" x="472.3958" y="1131.72">at2</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="494.2708" y="1131.72">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="5.2083" x="502.6042" y="1131.72">t</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="507.8125" y="1131.72">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="582.8125" x2="626.5625" y1="1212.7604" y2="1212.7604"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="626.5625" x2="626.5625" y1="1212.7604" y2="1226.3021"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="583.8542" x2="626.5625" y1="1226.3021" y2="1226.3021"/><polygon fill="#2FA4E7" points="594.2708,1222.1354,583.8542,1226.3021,594.2708,1230.4688,590.1042,1226.3021" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="127.0833" x="595.3125" y="1202.5208">validate auth token</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="21.875" x="726.5625" y="1202.5208">at2</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="582.8125" x2="626.5625" y1="1265.8529" y2="1265.8529"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="626.5625" x2="626.5625" y1="1265.8529" y2="1279.3945"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="583.8542" x2="626.5625" y1="1279.3945" y2="1279.3945"/><polygon fill="#2FA4E7" points="594.2708,1275.2279,583.8542,1279.3945,594.2708,1283.5612,590.1042,1279.3945" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="130.2083" x="595.3125" y="1255.6132">validate transaction</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="5.2083" x="729.6875" y="1255.6132">t</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="582.8125" x2="626.5625" y1="1333.4961" y2="1333.4961"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="626.5625" x2="626.5625" y1="1333.4961" y2="1347.0378"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="583.8542" x2="626.5625" y1="1347.0378" y2="1347.0378"/><polygon fill="#2FA4E7" points="594.2708,1342.8711,583.8542,1347.0378,594.2708,1351.2044,590.1042,1347.0378" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="106.25" x="595.3125" y="1308.7056">sign transaction</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="595.3125" y="1323.2564">st</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="169.7917" x="610.9375" y="1323.2564">= SignSolanaTransaction(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="5.2083" x="780.7292" y="1323.2564">t</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="785.9375" y="1323.2564">)</text><polygon fill="#2FA4E7" points="357.8125,1382.4219,347.3958,1386.5885,357.8125,1390.7552,353.6458,1386.5885" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="351.5625" x2="571.3542" y1="1386.5885" y2="1386.5885"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="66.6667" x="369.2708" y="1376.3489">response(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="435.9375" y="1376.3489">st</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="447.3958" y="1376.3489">)</text><rect fill="url(#g1ftdxjd0shnff2)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#g1ftdxjd0shnff2);stroke-width:1.0416666666666667;" width="955.7292" x="10.4167" y="1452.1973"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="1452.1973" y2="1452.1973"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="1455.3223" y2="1455.3223"/><rect fill="url(#g1ftdxjd0shnff2)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="309.375" x="333.5938" y="1436.5885"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="280.2083" x="345.0521" y="1457.5663">Submit signed transaction to network</text><polygon fill="#2FA4E7" points="229.1667,1507.3568,218.75,1511.5234,229.1667,1515.6901,225,1511.5234" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="222.9167" x2="340.1042" y1="1511.5234" y2="1511.5234"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="240.625" y="1501.2838">{</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="11.4583" x="248.9583" y="1501.2838">st</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="260.4167" y="1501.2838">}</text><rect fill="url(#g1ftdxjd0shnff0)" height="54.1016" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="77.0833" x="140.625" y="1480.306"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="44.7917" x="156.7708" y="1504.4088">Solana</text><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="52.0833" x="153.125" y="1518.9596">network</text><rect fill="url(#g1ftdxjd0shnff2)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#g1ftdxjd0shnff2);stroke-width:1.0416666666666667;" width="955.7292" x="10.4167" y="1571.8913"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="1571.8913" y2="1571.8913"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="966.1458" y1="1575.0163" y2="1575.0163"/><rect fill="url(#g1ftdxjd0shnff2)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="98.9583" x="438.8021" y="1556.2826"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="69.7917" x="450.2604" y="1577.2603">Complete</text><rect fill="#FFFFFF" height="208.4147" rx="4.1667" ry="4.1667" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="769.7917" x="102.8646" y="1611.4583"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="119.5313" y="1643.7449"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="3.125" x="123.6979" y="1643.7449">i</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="12.5" x="126.8229" y="1643.7449">   </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="307.2917" x="170.5729" y="1643.7449">the dapp identity (name, icon, website URI)</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="119.5313" y="1671.1375"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="123.6979" y="1671.1375">at</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="8.3333" x="137.2396" y="1671.1375">  </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="643.75" x="170.5729" y="1671.1375">a persistent authentication token issued by the wallet to this dapp which is no longer valid</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="119.5313" y="1698.5301"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="123.6979" y="1698.5301">at2</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="146.6146" y="1698.5301"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="436.4583" x="170.5729" y="1698.5301">a persistent authentication token with the same privileges as</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="13.5417" x="611.1979" y="1698.5301">at</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="92.7083" x="628.9063" y="1698.5301">which is valid</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="119.5313" y="1725.9226"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="28.125" x="123.6979" y="1725.9226">pub</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="151.8229" y="1725.9226"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="443.75" x="170.5729" y="1725.9226">the wallet account public key for which this dapp is authorized</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="119.5313" y="1753.3152"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="5.2083" x="123.6979" y="1753.3152">t</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="12.5" x="128.9063" y="1753.3152">   </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="373.9583" x="170.5729" y="1753.3152">the transaction that the dapp wishes to have signed</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="266.6667" x="166.4063" y="1770.2911">with the private key corresponding to</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="28.125" x="437.2396" y="1770.2911">pub</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="465.3646" y="1770.2911"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="119.5313" y="1797.6837"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="12.5" x="123.6979" y="1797.6837">st</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="8.3333" x="136.1979" y="1797.6837">  </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="166.4063" y="1797.6837"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="5.2083" x="170.5729" y="1797.6837">t</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="328.125" x="175.7813" y="1797.6837">, signed with the private key corresponding to</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="28.125" x="508.0729" y="1797.6837">pub</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="154.1667" x="536.1979" y="1797.6837">                                     </text><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="114.3229" x2="861.1979" y1="1625" y2="1625"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="114.3229" x2="861.1979" y1="1652.3926" y2="1652.3926"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="114.3229" x2="861.1979" y1="1679.7852" y2="1679.7852"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="114.3229" x2="861.1979" y1="1707.1777" y2="1707.1777"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="114.3229" x2="861.1979" y1="1734.5703" y2="1734.5703"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="114.3229" x2="861.1979" y1="1778.9388" y2="1778.9388"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="114.3229" x2="861.1979" y1="1806.3314" y2="1806.3314"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="114.3229" x2="114.3229" y1="1625" y2="1806.3314"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="161.1979" x2="161.1979" y1="1625" y2="1806.3314"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="861.1979" x2="861.1979" y1="1625" y2="1806.3314"/><!--MD5=[0c81cdac2830a10f5b4a5d99b591eddb]
@startuml

!theme cerulean
skinparam backgroundColor #FFFFFF

hide footbox

participant Solana as "Solana\nnetwork"
participant Dapp
participant Wallet

note across : Dapp has established a session with Wallet for transaction signing using a previously obtained auth token

activate Dapp

Dapp -> Dapp : <i>at</i>, <i>pub</i> = Load()
Dapp -> Dapp : <i>t</i> = CreateTransaction(<i>pub</i>, ...)

== Submit for signing with cached auth token ==

Dapp -> Wallet ++- - : sign_transaction {<i>at</i>, <i>t</i>}
Wallet -X Wallet : validate auth token <i>at</i>
Wallet - -> Dapp ++- - : error {ERROR_REAUTHORIZE}

== Reauthorize ==

Dapp -> Dapp : <i>i</i> = DappIdentity()
Dapp -> Wallet ++- - : reauthorize {<i>i</i>, <i>at</i>}
Wallet -> Wallet : validate Dapp identity <i>i</i> matches <i>at</i>
Wallet -> Wallet : Generate new auth token\n<i>at2</i> = RegenerateAuthToken(<i>i</i>, <i>at</i>)
Wallet -> Wallet : <i>pub</i> = base58encode(GetPublicKey())
alt if wallet endpoint has an endpoint-specific URI
    Wallet -> Wallet : <i>uri</i> = EndpointBaseURI() 
end
Wallet - -> Dapp ++- - : response(<i>at2</i>, <i>pub</i>, <i>uri</i>)
Dapp -> Dapp : Store(<i>at2</i>, <i>pub</i>, <i>uri</i>)

== Resubmit for signing with new auth token ==

Dapp -> Wallet ++- - : sign_transaction(<i>at2</i>, <i>t</i>)
Wallet -> Wallet : validate auth token <i>at2</i>
Wallet -> Wallet : validate transaction <i>t</i>
Wallet -> Wallet : sign transaction\n<i>st</i> = SignSolanaTransaction(<i>t</i>)
Wallet - -> Dapp ++- - : response(<i>st</i>)

== Submit signed transaction to network ==

create Solana
Dapp - -> Solana - - : {<i>st</i>}

== Complete ==

legend
| <i>i</i>   | the dapp identity (name, icon, website URI)                                                           |
| <i>at</i>  | a persistent authentication token issued by the wallet to this dapp which is no longer valid          |
| <i>at2</i> | a persistent authentication token with the same privileges as <i>at</i> which is valid                |
| <i>pub</i> | the wallet account public key for which this dapp is authorized                                       |
| <i>t</i>   | the transaction that the dapp wishes to have signed\nwith the private key corresponding to <i>pub</i> |
| <i>st</i>  | <i>t</i>, signed with the private key corresponding to <i>pub</i>                                     |
end legend

@enduml

@startuml




skinparam backgroundColor transparent
skinparam useBetaStyle false






<style>
  root {
    BackgroundColor transparent
    FontColor #FFF
    HyperLinkColor #FD7E14
    LineColor #2683B9
    LineThickness 1
    Margin 10
    Padding 6
    Shadowing 0.0
  }
  node {
   Padding 15
   roundcorner 20
   BackgroundColor #2FA4E7-#2683B9
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  groupHeader {
    BackgroundColor #E9ECEF
    FontColor #033C73
    FontStyle bold
  }
  header {
    LineThickness 0
  }
  referenceHeader {
    BackgroundColor transparent
    FontColor #343A40
    FontStyle bold
  }
  separator {
    BackgroundColor #343A40
    FontColor transparent
    FontStyle bold
  }
  title {
	FontSize 20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor  #EDF0F2-#E9ECEF
	FontColor #2FA4E7
	BorderColor #E9ECEF
  }
  nwdiagDiagram {
	network {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7    
		LineColor #2FA4E7
		LineThickness 1.0
		FontColor #2683B9
	}
	server {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	}
	arrow {
		FontColor #2683B9
		LineColor #2683B9
	}
	group {
		BackGroundColor #F8F9FA
		LineColor $LIGHT_DARK
		LineThickness 2.0
		Margin 5
		Padding 5
	}
  }
  ganttDiagram {
	task {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
		LineColor #2FA4E7
		Margin 10
		Padding 6
	}
	note {
		FontColor #FFF
		LineColor #02305C
		BackGroundColor #033C73
	}
	separator {
		LineColor #E9ECEF
		BackGroundColor #E9ECEF-#BABDBF
		FontColor #343A40
	}
	milestone {
		FontColor #033C73
		FontSize 16
		FontStyle italic
		BackGroundColor #E9ECEF
		LineColor #BABDBF
	}
	timeline {
		BackgroundColor #E9ECEF
		FontColor #343A40
	}
	closed {
		BackgroundColor #B14500
		FontColor #FFF
	}
  }
</style>
skinparam defaultFontName        "Verdana"
skinparam defaultFontSize        12
skinparam dpi                    100
skinparam shadowing              false
skinparam roundcorner            8
skinparam ParticipantPadding     40
skinparam BoxPadding             40
skinparam Padding                5
skinparam ArrowColor             #868E96
skinparam stereotype {
    CBackgroundColor #EDF0F2
    CBorderColor #BABDBF
    ABackgroundColor #8FB961
    ABorderColor #5C862E
    IBackgroundColor #D2494E
    IBorderColor #9F161B
    EBackgroundColor #E47833
    EBorderColor #B14500
    NBackgroundColor #35638F
    NBorderColor #02305C
}
skinparam title {
	FontColor	                 #2FA4E7
	BorderColor	                 #BABDBF
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              #EDF0F2-#E9ECEF
}


skinparam legend {
	BackgroundColor #E9ECEF
	BorderColor #BABDBF
	FontColor #343A40
}

skinparam swimlane {
	BorderColor #033C73
	BorderThickness 2
	TitleBackgroundColor  #EDF0F2-#E9ECEF
	TitleFontColor #2FA4E7
}


skinparam activity {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BarColor #73A839
	StartColor #033C73
	EndColor #033C73
	DiamondBackgroundColor #FFF-#EDF0F2
  	DiamondBorderColor #BABDBF
	DiamondFontColor #343A40
}


skinparam participant {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	ParticipantBorderThickness 2
}


skinparam actor {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam arrow {
	Thickness 3
	Color #2FA4E7
	FontColor #343A40
}


skinparam sequence {
	BorderColor #2FA4E7
	TitleFontColor #2FA4E7
	BackgroundColor transparent
	StartColor #2FA4E7
	EndColor #2FA4E7
	BoxBackgroundColor #F8F9FA
	BoxBorderColor #868E96
	BoxFontColor #343A40
	DelayFontColor #343A40
	LifeLineBorderColor #BABDBF
	LifeLineBorderThickness 2
	LifeLineBackgroundColor #EDF0F2
	GroupBorderColor #868E96
	GroupFontColor #343A40
	GroupHeaderFontColor #033C73
	DividerBackgroundColor #FFF-#F8F9FA
    DividerBorderColor #868E96
    DividerBorderThickness 2
    DividerFontColor #343A40
	ReferenceBackgroundColor transparent
	ReferenceBorderColor #868E96
	ReferenceFontColor #343A40
	ReferenceHeaderFontColor #033C73
	StereotypeFontColor #FFF
}


skinparam partition {
	BorderColor #2FA4E7
	FontColor #2FA4E7
	BackgroundColor transparent
}


skinparam collections {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam control {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam entity {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam boundary {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam agent {
	BackgroundColor #orange
	BorderColor #999999
	FontColor #333333
}


skinparam note {
	BorderThickness 1
	BackgroundColor #35638F-#033C73
	BorderColor #033C73
	FontColor #FFF
}


skinparam artifact {
	BackgroundColor #FFF-#F8F9FA
	BorderColor #BABDBF
	FontColor #343A40
}


skinparam component {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam interface {
	BackgroundColor  #D2494E
	BorderColor  #C71C22
	FontColor #343A40
}


skinparam storage {
	BackgroundColor #E47833-#DD5600
  	BorderColor #DD5600
	FontColor #FFF
}


skinparam node {
	BackgroundColor #EDF0F2-#E9ECEF
	BorderColor #E9ECEF
	FontColor #343A40
}


skinparam cloud {
	BackgroundColor #F2FCFE-#eeeeee
	BorderColor #F2FCFE
	FontColor #2FA4E7
}


skinparam database {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam class {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	HeaderBackgroundColor #2FA4E7-#2683B9
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #F8F9FA
	AttributeFontSize 11
}


skinparam object {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam usecase {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam rectangle {
	FontColor #2FA4E7
	BorderColor #59B6EC
	BackgroundColor transparent
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam package {
	FontColor #2FA4E7
	BorderColor #59B6EC
	BackgroundColor transparent
	BorderThickness 2
}


skinparam folder {
	BackgroundColor #FFF-#EDF0F2
  	BorderColor #DD5600
	FontColor #DD5600
	BorderThickness 2
}


skinparam frame {
	BackgroundColor #FFF-#EDF0F2
  	BorderColor #033C73
	FontColor #033C73
	BorderThickness 2
}


skinparam state {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BorderColor #2683B9
	StartColor #033C73
	EndColor #033C73
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam queue {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam card {
	BackgroundColor #35638F-#033C73
	BorderColor #033C73
	FontColor #FFF
}


skinparam file {
	BackgroundColor #EDF0F2-#E9ECEF
	BorderColor #033C73
	FontColor #868E96

}


skinparam stack {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}
skinparam backgroundColor #FFFFFF

hide footbox

participant Solana as "Solana\nnetwork"
participant Dapp
participant Wallet

note across : Dapp has established a session with Wallet for transaction signing using a previously obtained auth token

activate Dapp

Dapp -> Dapp : <i>at</i>, <i>pub</i> = Load()
Dapp -> Dapp : <i>t</i> = CreateTransaction(<i>pub</i>, ...)

== Submit for signing with cached auth token ==

Dapp -> Wallet ++- - : sign_transaction {<i>at</i>, <i>t</i>}
Wallet -X Wallet : validate auth token <i>at</i>
Wallet - -> Dapp ++- - : error {ERROR_REAUTHORIZE}

== Reauthorize ==

Dapp -> Dapp : <i>i</i> = DappIdentity()
Dapp -> Wallet ++- - : reauthorize {<i>i</i>, <i>at</i>}
Wallet -> Wallet : validate Dapp identity <i>i</i> matches <i>at</i>
Wallet -> Wallet : Generate new auth token\n<i>at2</i> = RegenerateAuthToken(<i>i</i>, <i>at</i>)
Wallet -> Wallet : <i>pub</i> = base58encode(GetPublicKey())
alt if wallet endpoint has an endpoint-specific URI
    Wallet -> Wallet : <i>uri</i> = EndpointBaseURI() 
end
Wallet - -> Dapp ++- - : response(<i>at2</i>, <i>pub</i>, <i>uri</i>)
Dapp -> Dapp : Store(<i>at2</i>, <i>pub</i>, <i>uri</i>)

== Resubmit for signing with new auth token ==

Dapp -> Wallet ++- - : sign_transaction(<i>at2</i>, <i>t</i>)
Wallet -> Wallet : validate auth token <i>at2</i>
Wallet -> Wallet : validate transaction <i>t</i>
Wallet -> Wallet : sign transaction\n<i>st</i> = SignSolanaTransaction(<i>t</i>)
Wallet - -> Dapp ++- - : response(<i>st</i>)

== Submit signed transaction to network ==

create Solana
Dapp - -> Solana - - : {<i>st</i>}

== Complete ==

legend
| <i>i</i>   | the dapp identity (name, icon, website URI)                                                           |
| <i>at</i>  | a persistent authentication token issued by the wallet to this dapp which is no longer valid          |
| <i>at2</i> | a persistent authentication token with the same privileges as <i>at</i> which is valid                |
| <i>pub</i> | the wallet account public key for which this dapp is authorized                                       |
| <i>t</i>   | the transaction that the dapp wishes to have signed\nwith the private key corresponding to <i>pub</i> |
| <i>st</i>  | <i>t</i>, signed with the private key corresponding to <i>pub</i>                                     |
end legend

@enduml

PlantUML version 1.2022.6(Tue Jun 21 17:34:49 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>