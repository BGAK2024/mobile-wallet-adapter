<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1312.5px" preserveAspectRatio="none" style="width:636px;height:1312px;background:#FFFFFF;" version="1.1" viewBox="0 0 636 1312" width="636.4583px" zoomAndPan="magnify"><defs><linearGradient id="g10znphidayg50" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#59B6EC"/><stop offset="100%" stop-color="#2FA4E7"/></linearGradient><linearGradient id="g10znphidayg51" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#35638F"/><stop offset="100%" stop-color="#033C73"/></linearGradient><linearGradient id="g10znphidayg52" x1="50%" x2="50%" y1="0%" y2="100%"><stop offset="0%" stop-color="#FFFFFF"/><stop offset="100%" stop-color="#F8F9FA"/></linearGradient></defs><g><rect fill="#EDF0F2" height="521.4844" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="107.8125" y="61.4258"/><rect fill="#EDF0F2" height="205.0781" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="107.8125" y="728.6458"/><rect fill="#EDF0F2" height="636.0352" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="376.5625" y="368.4896"/><rect fill="#EDF0F2" height="244.6289" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="381.7708" y="582.9102"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="112.5" x2="112.5" y1="51.0091" y2="1013.8997"/><line style="stroke:#BABDBF;stroke-width:1.0416666666666667;stroke-dasharray:5.0,5.0;" x1="381.7708" x2="381.7708" y1="51.0091" y2="1013.8997"/><rect fill="url(#g10znphidayg50)" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="59.375" x="83.3333" y="10.4167"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="34.375" x="95.8333" y="34.5194">Dapp</text><rect fill="url(#g10znphidayg50)" height="39.5508" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" width="64.5833" x="349.4792" y="10.4167"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="39.5833" x="361.9792" y="34.5194">Wallet</text><rect fill="#EDF0F2" height="521.4844" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="107.8125" y="61.4258"/><rect fill="#EDF0F2" height="205.0781" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="107.8125" y="728.6458"/><rect fill="#EDF0F2" height="636.0352" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="376.5625" y="368.4896"/><rect fill="#EDF0F2" height="244.6289" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="10.4167" x="381.7708" y="582.9102"/><path d="M15.625,70.8008 L15.625,96.8424 A4.1667,4.1667 0 0 0 19.7917,101.0091 L475,101.0091 A4.1667,4.1667 0 0 0 479.1667,96.8424 L479.1667,77.0508 L468.75,66.6341 L19.7917,66.6341 A4.1667,4.1667 0 0 0 15.625,70.8008 " fill="url(#g10znphidayg51)" style="stroke:#2683B9;stroke-width:1.0416666666666667;"/><path d="M468.75,66.6341 L468.75,74.9674 A2.0833,2.0833 0 0 0 470.8333,77.0508 L479.1667,77.0508 L468.75,66.6341 " fill="url(#g10znphidayg51)" style="stroke:#2683B9;stroke-width:1.0416666666666667;"/><text fill="#FFFFFF" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="431.25" x="27.0833" y="88.6536">User initiates a wallet request (e.g. transaction signing) in a dapp</text><rect fill="url(#g10znphidayg52)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#g10znphidayg52);stroke-width:1.0416666666666667;" width="614.0625" x="10.4167" y="140.5273"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="624.4792" y1="140.5273" y2="140.5273"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="624.4792" y1="143.6523" y2="143.6523"/><rect fill="url(#g10znphidayg52)" height="47.8516" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="379.1667" x="127.8646" y="117.6432"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="354.1667" x="139.3229" y="138.621">Establish association between Dapp and Wallet</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="348.9583" x="139.3229" y="153.1718">This could be via Android Intent, QR code, etc...</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="118.2292" x2="161.9792" y1="207.1289" y2="207.1289"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="161.9792" x2="161.9792" y1="207.1289" y2="220.6706"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="119.2708" x2="161.9792" y1="220.6706" y2="220.6706"/><polygon fill="#2FA4E7" points="129.6875,216.5039,119.2708,220.6706,129.6875,224.8372,125.5208,220.6706" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="145.8333" x="130.7292" y="196.8892">generate ECDSA pair (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="276.5625" y="196.8892">d_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="299.4792" y="196.8892">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="307.8125" y="196.8892">Q_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="330.7292" y="196.8892">)</text><polygon fill="#2FA4E7" points="369.2708,256.0547,379.6875,260.2214,369.2708,264.388,373.4375,260.2214" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="118.2292" x2="375.5208" y1="260.2214" y2="260.2214"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="130.7292" y="249.9817">{</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="139.0625" y="249.9817">Q_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="161.9792" y="249.9817">}</text><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="363.0208" x2="373.4375" y1="294.5638" y2="304.9805"/><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="363.0208" x2="373.4375" y1="304.9805" y2="294.5638"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="118.2292" x2="368.2292" y1="299.7721" y2="299.7721"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="228.125" x="130.7292" y="289.5325">poll for WebSocket server available</text><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="363.0208" x2="373.4375" y1="309.1471" y2="319.5638"/><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="363.0208" x2="373.4375" y1="319.5638" y2="309.1471"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="118.2292" x2="368.2292" y1="314.3555" y2="314.3555"/><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="363.0208" x2="373.4375" y1="323.7305" y2="334.1471"/><line style="stroke:#2FA4E7;stroke-width:2.0833333333333335;" x1="363.0208" x2="373.4375" y1="334.1471" y2="323.7305"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="118.2292" x2="368.2292" y1="328.9388" y2="328.9388"/><polygon fill="#2FA4E7" points="364.0625,364.3229,374.4792,368.4896,364.0625,372.6563,368.2292,368.4896" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:2.0,2.0;" x1="118.2292" x2="370.3125" y1="368.4896" y2="368.4896"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="53.125" x="130.7292" y="358.2499">connect</text><rect fill="url(#g10znphidayg52)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#g10znphidayg52);stroke-width:1.0416666666666667;" width="614.0625" x="10.4167" y="410.1237"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="624.4792" y1="410.1237" y2="410.1237"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="624.4792" y1="413.2487" y2="413.2487"/><rect fill="url(#g10znphidayg52)" height="47.8516" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="362.5" x="136.1979" y="387.2396"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="260.4167" x="147.6563" y="408.2174">WebSocket connection established</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="333.3333" x="147.6563" y="422.7681">Perform ECDH to obtain a unique session key</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="118.2292" x2="161.9792" y1="476.7253" y2="476.7253"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="161.9792" x2="161.9792" y1="476.7253" y2="490.2669"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="119.2708" x2="161.9792" y1="490.2669" y2="490.2669"/><polygon fill="#2FA4E7" points="129.6875,486.1003,119.2708,490.2669,129.6875,494.4336,125.5208,490.2669" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="138.5417" x="130.7292" y="466.4856">generate ECDH pair (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="269.2708" y="466.4856">d_d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="292.1875" y="466.4856">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="300.5208" y="466.4856">Q_d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="323.4375" y="466.4856">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="118.2292" x2="161.9792" y1="529.8177" y2="529.8177"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="161.9792" x2="161.9792" y1="529.8177" y2="543.3594"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="119.2708" x2="161.9792" y1="543.3594" y2="543.3594"/><polygon fill="#2FA4E7" points="129.6875,539.1927,119.2708,543.3594,129.6875,547.526,125.5208,543.3594" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="120.8333" x="130.7292" y="519.578">S_a = ECDSA-sign(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="251.5625" y="519.578">d_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="274.4792" y="519.578">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="282.8125" y="519.578">Q_d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="305.7292" y="519.578">)</text><polygon fill="#2FA4E7" points="369.2708,578.7435,379.6875,582.9102,369.2708,587.0768,373.4375,582.9102" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="113.0208" x2="375.5208" y1="582.9102" y2="582.9102"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="84.375" x="125.5208" y="572.6705">HELLO_REQ {</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="209.8958" y="572.6705">Q_d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="236.9792" y="572.6705">||</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="249.4792" y="572.6705">S_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="272.3958" y="572.6705">}</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="392.1875" x2="435.9375" y1="622.4609" y2="622.4609"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="435.9375" x2="435.9375" y1="622.4609" y2="636.0026"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="393.2292" x2="435.9375" y1="636.0026" y2="636.0026"/><polygon fill="#2FA4E7" points="403.6458,631.8359,393.2292,636.0026,403.6458,640.1693,399.4792,636.0026" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="33.3333" x="404.6875" y="612.2213">verify</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="442.1875" y="612.2213">S_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="26.0417" x="469.2708" y="612.2213">with</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="499.4792" y="612.2213">Q_a</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="392.1875" x2="435.9375" y1="675.5534" y2="675.5534"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="435.9375" x2="435.9375" y1="675.5534" y2="689.0951"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="393.2292" x2="435.9375" y1="689.0951" y2="689.0951"/><polygon fill="#2FA4E7" points="403.6458,684.9284,393.2292,689.0951,403.6458,693.2617,399.4792,689.0951" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="138.5417" x="404.6875" y="665.3137">generate ECDH pair (</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="543.2292" y="665.3137">d_w</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="568.2292" y="665.3137">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="576.5625" y="665.3137">Q_w</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="601.5625" y="665.3137">)</text><polygon fill="#2FA4E7" points="129.6875,724.4792,119.2708,728.6458,129.6875,732.8125,125.5208,728.6458" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="123.4375" x2="380.7292" y1="728.6458" y2="728.6458"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="83.3333" x="141.1458" y="718.4062">HELLO_RSP {</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="224.4792" y="718.4062">Q_w</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="8.3333" x="249.4792" y="718.4062">}</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="392.1875" x2="435.9375" y1="768.1966" y2="768.1966"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="435.9375" x2="435.9375" y1="768.1966" y2="781.7383"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="393.2292" x2="435.9375" y1="781.7383" y2="781.7383"/><polygon fill="#2FA4E7" points="403.6458,777.5716,393.2292,781.7383,403.6458,785.9049,399.4792,781.7383" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="404.6875" y="757.9569">Z</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="55.2083" x="417.1875" y="757.9569">= ECDH(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="472.3958" y="757.9569">d_w</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="497.3958" y="757.9569">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="505.7292" y="757.9569">Q_d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="528.6458" y="757.9569">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="392.1875" x2="435.9375" y1="826.4974" y2="826.4974"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="435.9375" x2="435.9375" y1="826.4974" y2="840.0391"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="386.9792" x2="435.9375" y1="840.0391" y2="840.0391"/><polygon fill="#2FA4E7" points="397.3958,835.8724,386.9792,840.0391,397.3958,844.2057,393.2292,840.0391" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="404.6875" y="816.2577">K</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="53.125" x="417.1875" y="816.2577">= HKDF(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="470.3125" y="816.2577">Z</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="478.6458" y="816.2577">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="486.9792" y="816.2577">Q_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="30.2083" x="509.8958" y="816.2577">, 16)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="118.2292" x2="161.9792" y1="874.3815" y2="874.3815"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="161.9792" x2="161.9792" y1="874.3815" y2="887.9232"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="119.2708" x2="161.9792" y1="887.9232" y2="887.9232"/><polygon fill="#2FA4E7" points="129.6875,883.7565,119.2708,887.9232,129.6875,892.0898,125.5208,887.9232" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="130.7292" y="864.1418">Z</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="55.2083" x="143.2292" y="864.1418">= ECDH(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="198.4375" y="864.1418">d_d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="221.3542" y="864.1418">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="25" x="229.6875" y="864.1418">Q_w</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="5.2083" x="254.6875" y="864.1418">)</text><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="118.2292" x2="161.9792" y1="932.6823" y2="932.6823"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="161.9792" x2="161.9792" y1="932.6823" y2="946.224"/><line style="stroke:#2FA4E7;stroke-width:3.125;" x1="113.0208" x2="161.9792" y1="946.224" y2="946.224"/><polygon fill="#2FA4E7" points="123.4375,942.0573,113.0208,946.224,123.4375,950.3906,119.2708,946.224" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="130.7292" y="922.4426">K</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="53.125" x="143.2292" y="922.4426">= HKDF(</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="8.3333" x="196.3542" y="922.4426">Z</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="4.1667" x="204.6875" y="922.4426">,</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-style="italic" lengthAdjust="spacing" textLength="22.9167" x="213.0208" y="922.4426">Q_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" lengthAdjust="spacing" textLength="30.2083" x="235.9375" y="922.4426">, 16)</text><rect fill="url(#g10znphidayg52)" height="3.125" rx="4.1667" ry="4.1667" style="stroke:url(#g10znphidayg52);stroke-width:1.0416666666666667;" width="614.0625" x="10.4167" y="975.3743"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="624.4792" y1="975.3743" y2="975.3743"/><line style="stroke:#868E96;stroke-width:1.0416666666666667;" x1="10.4167" x2="624.4792" y1="978.4993" y2="978.4993"/><rect fill="url(#g10znphidayg52)" height="33.3008" rx="4.1667" ry="4.1667" style="stroke:#868E96;stroke-width:2.0833333333333335;" width="461.4583" x="86.7188" y="959.7656"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="12.5" font-weight="bold" lengthAdjust="spacing" textLength="432.2917" x="98.1771" y="980.7434">cryptochannel ready for encrypted session communication</text><rect fill="#FFFFFF" height="273.6165" id="_legend" rx="4.1667" ry="4.1667" style="stroke:#BABDBF;stroke-width:1.0416666666666667;" width="467.7083" x="83.0729" y="1014.9414"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1047.228"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="25" x="103.9063" y="1047.228">d_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="128.9063" y="1047.228"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="295.8333" x="152.8646" y="1047.228">Dapp association ECDSA private keypoint</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1074.6206"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="27.0833" x="103.9063" y="1074.6206">Q_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="130.9896" y="1074.6206"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="290.625" x="152.8646" y="1074.6206">Dapp association ECDSA public keypoint</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1102.0131"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="26.0417" x="103.9063" y="1102.0131">d_d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="129.9479" y="1102.0131"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="368.75" x="152.8646" y="1102.0131">Dapp session establishment ECDH private keypoint</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1129.4057"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="28.125" x="103.9063" y="1129.4057">Q_d</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="132.0313" y="1129.4057"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="363.5417" x="152.8646" y="1129.4057">Dapp session establishment ECDH public keypoint</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1156.7983"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="25" x="103.9063" y="1156.7983">S_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="128.9063" y="1156.7983"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="277.0833" x="152.8646" y="1156.7983">Dapp ECDSA signature of Q_d with d_a</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1184.1909"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="28.125" x="103.9063" y="1184.1909">d_w</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="132.0313" y="1184.1909"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="372.9167" x="152.8646" y="1184.1909">Wallet session establishment ECDH private keypoint</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1211.5835"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="30.2083" x="103.9063" y="1211.5835">Q_w</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="134.1146" y="1211.5835"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="367.7083" x="152.8646" y="1211.5835">Wallet session establishment ECDH public keypoint</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1238.976"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="10.4167" x="103.9063" y="1238.976">Z</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="12.5" x="114.3229" y="1238.976">   </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="313.5417" x="152.8646" y="1238.976">Shared session establishment ECDH secret</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="4.1667" x="99.7396" y="1266.3686"> </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" font-style="italic" lengthAdjust="spacing" textLength="9.375" x="103.9063" y="1266.3686">K</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="12.5" x="113.2813" y="1266.3686">   </text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="14.5833" lengthAdjust="spacing" textLength="362.5" x="152.8646" y="1266.3686">Shared session establishment AES-128 secret key</text><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1028.4831" y2="1028.4831"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1055.8757" y2="1055.8757"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1083.2682" y2="1083.2682"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1110.6608" y2="1110.6608"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1138.0534" y2="1138.0534"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1165.446" y2="1165.446"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1192.8385" y2="1192.8385"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1220.2311" y2="1220.2311"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1247.6237" y2="1247.6237"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="539.3229" y1="1275.0163" y2="1275.0163"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="94.5313" x2="94.5313" y1="1028.4831" y2="1275.0163"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="143.4896" x2="143.4896" y1="1028.4831" y2="1275.0163"/><line style="stroke:#343A40;stroke-width:1.0416666666666667;" x1="539.3229" x2="539.3229" y1="1028.4831" y2="1275.0163"/><!--MD5=[8a641c3b71ce4da137e72b57f8447336]
@startuml

!theme cerulean
skinparam backgroundColor #FFFFFF

hide footbox

note across : User initiates a wallet request (e.g. transaction signing) in a dapp

activate Dapp

== Establish association between Dapp and Wallet\nThis could be via Android Intent, QR code, etc... ==

Dapp -> Dapp : generate ECDSA pair (<i>d_a</i>, <i>Q_a</i>)

Dapp - -> Wallet : {<i>Q_a</i>}

Dapp - -X Wallet : poll for WebSocket server available
Dapp - -X Wallet
Dapp - -X Wallet
Dapp - -> Wallet ++ : connect

== WebSocket connection established\nPerform ECDH to obtain a unique session key ==

Dapp -> Dapp : generate ECDH pair (<i>d_d</i>, <i>Q_d</i>)
Dapp -> Dapp : S_a = ECDSA-sign(<i>d_a</i>, <i>Q_d</i>)
Dapp -> Wallet - -++ : HELLO_REQ {<i>Q_d</i> || <i>S_a</i>}

Wallet -> Wallet : verify <i>S_a</i> with <i>Q_a</i>
Wallet -> Wallet : generate ECDH pair (<i>d_w</i>, <i>Q_w</i>)
Wallet -> Dapp ++ : HELLO_RSP {<i>Q_w</i>}

Wallet -> Wallet : <i>Z</i> = ECDH(<i>d_w</i>, <i>Q_d</i>)
Wallet -> Wallet : <i>K</i> = HKDF(<i>Z</i>, <i>Q_a</i>, 16)
Wallet - -

Dapp -> Dapp : <i>Z</i> = ECDH(<i>d_d</i>, <i>Q_w</i>)
Dapp -> Dapp : <i>K</i> = HKDF(<i>Z</i>, <i>Q_a</i>, 16)
Dapp - -

== cryptochannel ready for encrypted session communication ==

legend
| <i>d_a</i> | Dapp association ECDSA private keypoint            |
| <i>Q_a</i> | Dapp association ECDSA public keypoint             |
| <i>d_d</i> | Dapp session establishment ECDH private keypoint   |
| <i>Q_d</i> | Dapp session establishment ECDH public keypoint    |
| <i>S_a</i> | Dapp ECDSA signature of Q_d with d_a               |
| <i>d_w</i> | Wallet session establishment ECDH private keypoint |
| <i>Q_w</i> | Wallet session establishment ECDH public keypoint  |
| <i>Z</i>   | Shared session establishment ECDH secret           |
| <i>K</i>   | Shared session establishment AES-128 secret key    |
end legend

@enduml

@startuml




skinparam backgroundColor transparent
skinparam useBetaStyle false






<style>
  root {
    BackgroundColor transparent
    FontColor #FFF
    HyperLinkColor #FD7E14
    LineColor #2683B9
    LineThickness 1
    Margin 10
    Padding 6
    Shadowing 0.0
  }
  node {
   Padding 15
   roundcorner 20
   BackgroundColor #2FA4E7-#2683B9
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  groupHeader {
    BackgroundColor #E9ECEF
    FontColor #033C73
    FontStyle bold
  }
  header {
    LineThickness 0
  }
  referenceHeader {
    BackgroundColor transparent
    FontColor #343A40
    FontStyle bold
  }
  separator {
    BackgroundColor #343A40
    FontColor transparent
    FontStyle bold
  }
  title {
	FontSize 20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor  #EDF0F2-#E9ECEF
	FontColor #2FA4E7
	BorderColor #E9ECEF
  }
  nwdiagDiagram {
	network {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7    
		LineColor #2FA4E7
		LineThickness 1.0
		FontColor #2683B9
	}
	server {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	}
	arrow {
		FontColor #2683B9
		LineColor #2683B9
	}
	group {
		BackGroundColor #F8F9FA
		LineColor $LIGHT_DARK
		LineThickness 2.0
		Margin 5
		Padding 5
	}
  }
  ganttDiagram {
	task {
			FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
		LineColor #2FA4E7
		Margin 10
		Padding 6
	}
	note {
		FontColor #FFF
		LineColor #02305C
		BackGroundColor #033C73
	}
	separator {
		LineColor #E9ECEF
		BackGroundColor #E9ECEF-#BABDBF
		FontColor #343A40
	}
	milestone {
		FontColor #033C73
		FontSize 16
		FontStyle italic
		BackGroundColor #E9ECEF
		LineColor #BABDBF
	}
	timeline {
		BackgroundColor #E9ECEF
		FontColor #343A40
	}
	closed {
		BackgroundColor #B14500
		FontColor #FFF
	}
  }
</style>
skinparam defaultFontName        "Verdana"
skinparam defaultFontSize        12
skinparam dpi                    100
skinparam shadowing              false
skinparam roundcorner            8
skinparam ParticipantPadding     40
skinparam BoxPadding             40
skinparam Padding                5
skinparam ArrowColor             #868E96
skinparam stereotype {
    CBackgroundColor #EDF0F2
    CBorderColor #BABDBF
    ABackgroundColor #8FB961
    ABorderColor #5C862E
    IBackgroundColor #D2494E
    IBorderColor #9F161B
    EBackgroundColor #E47833
    EBorderColor #B14500
    NBackgroundColor #35638F
    NBorderColor #02305C
}
skinparam title {
	FontColor	                 #2FA4E7
	BorderColor	                 #BABDBF
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              #EDF0F2-#E9ECEF
}


skinparam legend {
	BackgroundColor #E9ECEF
	BorderColor #BABDBF
	FontColor #343A40
}

skinparam swimlane {
	BorderColor #033C73
	BorderThickness 2
	TitleBackgroundColor  #EDF0F2-#E9ECEF
	TitleFontColor #2FA4E7
}


skinparam activity {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BarColor #73A839
	StartColor #033C73
	EndColor #033C73
	DiamondBackgroundColor #FFF-#EDF0F2
  	DiamondBorderColor #BABDBF
	DiamondFontColor #343A40
}


skinparam participant {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	ParticipantBorderThickness 2
}


skinparam actor {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam arrow {
	Thickness 3
	Color #2FA4E7
	FontColor #343A40
}


skinparam sequence {
	BorderColor #2FA4E7
	TitleFontColor #2FA4E7
	BackgroundColor transparent
	StartColor #2FA4E7
	EndColor #2FA4E7
	BoxBackgroundColor #F8F9FA
	BoxBorderColor #868E96
	BoxFontColor #343A40
	DelayFontColor #343A40
	LifeLineBorderColor #BABDBF
	LifeLineBorderThickness 2
	LifeLineBackgroundColor #EDF0F2
	GroupBorderColor #868E96
	GroupFontColor #343A40
	GroupHeaderFontColor #033C73
	DividerBackgroundColor #FFF-#F8F9FA
    DividerBorderColor #868E96
    DividerBorderThickness 2
    DividerFontColor #343A40
	ReferenceBackgroundColor transparent
	ReferenceBorderColor #868E96
	ReferenceFontColor #343A40
	ReferenceHeaderFontColor #033C73
	StereotypeFontColor #FFF
}


skinparam partition {
	BorderColor #2FA4E7
	FontColor #2FA4E7
	BackgroundColor transparent
}


skinparam collections {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam control {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam entity {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam boundary {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam agent {
	BackgroundColor #orange
	BorderColor #999999
	FontColor #333333
}


skinparam note {
	BorderThickness 1
	BackgroundColor #35638F-#033C73
	BorderColor #033C73
	FontColor #FFF
}


skinparam artifact {
	BackgroundColor #FFF-#F8F9FA
	BorderColor #BABDBF
	FontColor #343A40
}


skinparam component {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam interface {
	BackgroundColor  #D2494E
	BorderColor  #C71C22
	FontColor #343A40
}


skinparam storage {
	BackgroundColor #E47833-#DD5600
  	BorderColor #DD5600
	FontColor #FFF
}


skinparam node {
	BackgroundColor #EDF0F2-#E9ECEF
	BorderColor #E9ECEF
	FontColor #343A40
}


skinparam cloud {
	BackgroundColor #F2FCFE-#eeeeee
	BorderColor #F2FCFE
	FontColor #2FA4E7
}


skinparam database {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	FontColor #343A40
}


skinparam class {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	HeaderBackgroundColor #2FA4E7-#2683B9
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #F8F9FA
	AttributeFontSize 11
}


skinparam object {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam usecase {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam rectangle {
	FontColor #2FA4E7
	BorderColor #59B6EC
	BackgroundColor transparent
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam package {
	FontColor #2FA4E7
	BorderColor #59B6EC
	BackgroundColor transparent
	BorderThickness 2
}


skinparam folder {
	BackgroundColor #FFF-#EDF0F2
  	BorderColor #DD5600
	FontColor #DD5600
	BorderThickness 2
}


skinparam frame {
	BackgroundColor #FFF-#EDF0F2
  	BorderColor #033C73
	FontColor #033C73
	BorderThickness 2
}


skinparam state {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
	BorderColor #2683B9
	StartColor #033C73
	EndColor #033C73
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam queue {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}


skinparam card {
	BackgroundColor #35638F-#033C73
	BorderColor #033C73
	FontColor #FFF
}


skinparam file {
	BackgroundColor #EDF0F2-#E9ECEF
	BorderColor #033C73
	FontColor #868E96

}


skinparam stack {
		FontColor #FFF
	BorderColor #2FA4E7
	BackgroundColor #59B6EC-#2FA4E7
}
skinparam backgroundColor #FFFFFF

hide footbox

note across : User initiates a wallet request (e.g. transaction signing) in a dapp

activate Dapp

== Establish association between Dapp and Wallet\nThis could be via Android Intent, QR code, etc... ==

Dapp -> Dapp : generate ECDSA pair (<i>d_a</i>, <i>Q_a</i>)

Dapp - -> Wallet : {<i>Q_a</i>}

Dapp - -X Wallet : poll for WebSocket server available
Dapp - -X Wallet
Dapp - -X Wallet
Dapp - -> Wallet ++ : connect

== WebSocket connection established\nPerform ECDH to obtain a unique session key ==

Dapp -> Dapp : generate ECDH pair (<i>d_d</i>, <i>Q_d</i>)
Dapp -> Dapp : S_a = ECDSA-sign(<i>d_a</i>, <i>Q_d</i>)
Dapp -> Wallet - -++ : HELLO_REQ {<i>Q_d</i> || <i>S_a</i>}

Wallet -> Wallet : verify <i>S_a</i> with <i>Q_a</i>
Wallet -> Wallet : generate ECDH pair (<i>d_w</i>, <i>Q_w</i>)
Wallet -> Dapp ++ : HELLO_RSP {<i>Q_w</i>}

Wallet -> Wallet : <i>Z</i> = ECDH(<i>d_w</i>, <i>Q_d</i>)
Wallet -> Wallet : <i>K</i> = HKDF(<i>Z</i>, <i>Q_a</i>, 16)
Wallet - -

Dapp -> Dapp : <i>Z</i> = ECDH(<i>d_d</i>, <i>Q_w</i>)
Dapp -> Dapp : <i>K</i> = HKDF(<i>Z</i>, <i>Q_a</i>, 16)
Dapp - -

== cryptochannel ready for encrypted session communication ==

legend
| <i>d_a</i> | Dapp association ECDSA private keypoint            |
| <i>Q_a</i> | Dapp association ECDSA public keypoint             |
| <i>d_d</i> | Dapp session establishment ECDH private keypoint   |
| <i>Q_d</i> | Dapp session establishment ECDH public keypoint    |
| <i>S_a</i> | Dapp ECDSA signature of Q_d with d_a               |
| <i>d_w</i> | Wallet session establishment ECDH private keypoint |
| <i>Q_w</i> | Wallet session establishment ECDH public keypoint  |
| <i>Z</i>   | Shared session establishment ECDH secret           |
| <i>K</i>   | Shared session establishment AES-128 secret key    |
end legend

@enduml

PlantUML version 1.2022.9(Tue Sep 27 16:10:06 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>