<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Mobile Wallet Adapter specification - </title> <link rel="shortcut icon" href="/mobile-wallet-adapter/spec/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/mobile-wallet-adapter/spec/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/mobile-wallet-adapter/spec/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/mobile-wallet-adapter/spec/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.8.0 --> <title>Mobile Wallet Adapter specification</title> <meta name="generator" content="Jekyll v4.2.2" /> <meta property="og:title" content="Mobile Wallet Adapter specification" /> <meta property="og:locale" content="en_US" /> <meta property="og:type" content="website" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Mobile Wallet Adapter specification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","headline":"Mobile Wallet Adapter specification","url":"/mobile-wallet-adapter/spec/spec.html"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/mobile-wallet-adapter/spec/" class="site-title lh-tight"> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"><li class="nav-list-item active"><a href="/mobile-wallet-adapter/spec/spec.html" class="nav-list-link active">Mobile Wallet Adapter specification</a></li></ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search " aria-label="Search " autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <h1 id="mobile-wallet-adapter-specification"> <a href="#mobile-wallet-adapter-specification" class="anchor-heading" aria-labelledby="mobile-wallet-adapter-specification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Mobile Wallet Adapter specification </h1> <ol id="markdown-toc"> <li><a href="#mobile-wallet-adapter-specification" id="markdown-toc-mobile-wallet-adapter-specification">Mobile Wallet Adapter specification</a></li> <li><a href="#version" id="markdown-toc-version">Version</a> <ol> <li><a href="#changelog" id="markdown-toc-changelog">Changelog</a></li> </ol> </li> <li><a href="#non-normative-front-matter" id="markdown-toc-non-normative-front-matter">Non-normative front matter</a> <ol> <li><a href="#summary" id="markdown-toc-summary">Summary</a></li> <li><a href="#user-stories" id="markdown-toc-user-stories">User stories</a></li> <li><a href="#requirements" id="markdown-toc-requirements">Requirements</a></li> </ol> </li> <li><a href="#specification" id="markdown-toc-specification">Specification</a> <ol> <li><a href="#terminology" id="markdown-toc-terminology">Terminology</a></li> <li><a href="#transport" id="markdown-toc-transport">Transport</a> <ol> <li><a href="#websockets" id="markdown-toc-websockets">WebSockets</a></li> <li><a href="#bluetooth-le" id="markdown-toc-bluetooth-le">Bluetooth LE</a></li> </ol> </li> <li><a href="#association" id="markdown-toc-association">Association</a> <ol> <li><a href="#association-keypair" id="markdown-toc-association-keypair">Association keypair</a></li> <li><a href="#local-uri" id="markdown-toc-local-uri">Local URI</a> <ol> <li><a href="#android" id="markdown-toc-android">Android</a></li> <li><a href="#ios" id="markdown-toc-ios">iOS</a></li> <li><a href="#desktop" id="markdown-toc-desktop">Desktop</a></li> </ol> </li> <li><a href="#remote-uri" id="markdown-toc-remote-uri">Remote URI</a> <ol> <li><a href="#qr-codes" id="markdown-toc-qr-codes">QR codes</a></li> <li><a href="#clipboard" id="markdown-toc-clipboard">Clipboard</a></li> </ol> </li> <li><a href="#endpoint-specific-uris" id="markdown-toc-endpoint-specific-uris">Endpoint-specific URIs</a></li> <li><a href="#bluetooth-le-1" id="markdown-toc-bluetooth-le-1">Bluetooth LE</a></li> </ol> </li> <li><a href="#session-establishment" id="markdown-toc-session-establishment">Session establishment</a> <ol> <li><a href="#app_ping" id="markdown-toc-app_ping">APP_PING</a></li> <li><a href="#hello_req" id="markdown-toc-hello_req">HELLO_REQ</a> <ol> <li><a href="#direction" id="markdown-toc-direction">Direction</a></li> <li><a href="#specification-1" id="markdown-toc-specification-1">Specification</a></li> <li><a href="#description" id="markdown-toc-description">Description</a></li> </ol> </li> <li><a href="#hello_rsp" id="markdown-toc-hello_rsp">HELLO_RSP</a> <ol> <li><a href="#direction-1" id="markdown-toc-direction-1">Direction</a></li> <li><a href="#specification-2" id="markdown-toc-specification-2">Specification</a></li> <li><a href="#description-1" id="markdown-toc-description-1">Description</a></li> </ol> </li> </ol> </li> <li><a href="#wallet-rpc-interface" id="markdown-toc-wallet-rpc-interface">Wallet RPC interface</a> <ol> <li><a href="#operation" id="markdown-toc-operation">Operation</a></li> <li><a href="#encrypted-message-wrapping" id="markdown-toc-encrypted-message-wrapping">Encrypted message wrapping</a> <ol> <li><a href="#non-normative-commentary" id="markdown-toc-non-normative-commentary">Non-normative commentary</a></li> </ol> </li> <li><a href="#non-privileged-methods" id="markdown-toc-non-privileged-methods">Non-privileged methods</a> <ol> <li><a href="#authorize" id="markdown-toc-authorize">authorize</a> <ol> <li><a href="#json-rpc-method-specification" id="markdown-toc-json-rpc-method-specification">JSON-RPC method specification</a></li> <li><a href="#description-2" id="markdown-toc-description-2">Description</a></li> </ol> </li> <li><a href="#deauthorize" id="markdown-toc-deauthorize">deauthorize</a> <ol> <li><a href="#json-rpc-method-specification-1" id="markdown-toc-json-rpc-method-specification-1">JSON-RPC method specification</a></li> <li><a href="#description-3" id="markdown-toc-description-3">Description</a></li> </ol> </li> <li><a href="#reauthorize" id="markdown-toc-reauthorize">reauthorize</a> <ol> <li><a href="#json-rpc-method-specification-2" id="markdown-toc-json-rpc-method-specification-2">JSON-RPC method specification</a></li> <li><a href="#description-4" id="markdown-toc-description-4">Description</a></li> <li><a href="#non-normative-commentary-1" id="markdown-toc-non-normative-commentary-1">Non-normative commentary</a></li> </ol> </li> <li><a href="#get_capabilities" id="markdown-toc-get_capabilities">get_capabilities</a> <ol> <li><a href="#json-rpc-method-specification-3" id="markdown-toc-json-rpc-method-specification-3">JSON-RPC method specification</a></li> <li><a href="#description-5" id="markdown-toc-description-5">Description</a></li> </ol> </li> </ol> </li> <li><a href="#privileged-methods" id="markdown-toc-privileged-methods">Privileged methods</a> <ol> <li><a href="#sign_transactions" id="markdown-toc-sign_transactions">sign_transactions</a> <ol> <li><a href="#json-rpc-method-specification-4" id="markdown-toc-json-rpc-method-specification-4">JSON-RPC method specification</a></li> <li><a href="#description-6" id="markdown-toc-description-6">Description</a></li> </ol> </li> <li><a href="#sign_and_send_transactions" id="markdown-toc-sign_and_send_transactions">sign_and_send_transactions</a> <ol> <li><a href="#json-rpc-method-specification-5" id="markdown-toc-json-rpc-method-specification-5">JSON-RPC method specification</a></li> <li><a href="#description-7" id="markdown-toc-description-7">Description</a> <ol> <li><a href="#non-normative-commentary-2" id="markdown-toc-non-normative-commentary-2">Non-normative commentary</a></li> </ol> </li> </ol> </li> <li><a href="#sign_messages" id="markdown-toc-sign_messages">sign_messages</a> <ol> <li><a href="#json-rpc-method-specification-6" id="markdown-toc-json-rpc-method-specification-6">JSON-RPC method specification</a></li> <li><a href="#description-8" id="markdown-toc-description-8">Description</a></li> </ol> </li> <li><a href="#clone_authorization" id="markdown-toc-clone_authorization">clone_authorization</a> <ol> <li><a href="#json-rpc-method-specification-7" id="markdown-toc-json-rpc-method-specification-7">JSON-RPC method specification</a></li> <li><a href="#description-9" id="markdown-toc-description-9">Description</a> <ol> <li><a href="#non-normative-commentary-3" id="markdown-toc-non-normative-commentary-3">Non-normative commentary</a></li> </ol> </li> </ol> </li> </ol> </li> <li><a href="#constants" id="markdown-toc-constants">Constants</a></li> <li><a href="#illustrative-diagrams" id="markdown-toc-illustrative-diagrams">Illustrative diagrams</a> <ol> <li><a href="#session-establishment-1" id="markdown-toc-session-establishment-1">Session establishment</a></li> <li><a href="#encrypted-message-wrapping-1" id="markdown-toc-encrypted-message-wrapping-1">Encrypted message wrapping</a></li> <li><a href="#authorize-and-sign-transaction" id="markdown-toc-authorize-and-sign-transaction">Authorize and sign transaction</a></li> <li><a href="#reauthorize-and-sign-transaction" id="markdown-toc-reauthorize-and-sign-transaction">Reauthorize and sign transaction</a></li> </ol> </li> </ol> </li> <li><a href="#dapp-identity-verification" id="markdown-toc-dapp-identity-verification">Dapp identity verification</a> <ol> <li><a href="#android-1" id="markdown-toc-android-1">Android</a> <ol> <li><a href="#native-dapp" id="markdown-toc-native-dapp">Native dapp</a></li> <li><a href="#web-dapp" id="markdown-toc-web-dapp">Web dapp</a> <ol> <li><a href="#authorize-reauthorize-and-clone_authorization-modifications" id="markdown-toc-authorize-reauthorize-and-clone_authorization-modifications">authorize, reauthorize, and clone_authorization modifications</a></li> <li><a href="#non-normative-commentary-4" id="markdown-toc-non-normative-commentary-4">Non-normative commentary</a></li> </ol> </li> </ol> </li> <li><a href="#ios-1" id="markdown-toc-ios-1">iOS</a></li> <li><a href="#remote" id="markdown-toc-remote">Remote</a></li> </ol> </li> <li><a href="#reflector-protocol" id="markdown-toc-reflector-protocol">Reflector protocol</a></li> </ol> </li> <li><a href="#support-for-other-chains" id="markdown-toc-support-for-other-chains">Support for other chains</a></li> </ol> <h1 id="version"> <a href="#version" class="anchor-heading" aria-labelledby="version"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Version </h1> <p>This specification uses <a href="https://en.wikipedia.org/wiki/Software_versioning#Semantic_versioning">semantic versioning</a></p> <p><strong>Version: 0.9.1</strong></p> <h2 id="changelog"> <a href="#changelog" class="anchor-heading" aria-labelledby="changelog"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Changelog </h2> <div class="table-wrapper"><table> <thead> <tr> <th>Version</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>0.1.0</td> <td>Initial draft</td> </tr> <tr> <td>0.2.0</td> <td>Updates based on wallet adapter feedback</td> </tr> <tr> <td>0.2.1</td> <td>Fix a few missed pluralizations</td> </tr> <tr> <td>0.3.0</td> <td>Sessions now track authorization statefully, rather than by providing <code class="language-plaintext highlighter-rouge">auth_token</code> to each <a href="#privileged-methods">privileged method</a></td> </tr> <tr> <td>0.3.1</td> <td>Enforce HTTPS for endpoint-specific URIs</td> </tr> <tr> <td>0.3.2</td> <td>Replace timeout placeholders with minimum timeouts</td> </tr> <tr> <td>0.3.3</td> <td><code class="language-plaintext highlighter-rouge">sign_messages</code> should take multiple addresses for signing (for parity with <code class="language-plaintext highlighter-rouge">sign_transactions</code> behavior)</td> </tr> <tr> <td>0.9.0</td> <td>Advancing spec version to 0.9.0 (near-final version)</td> </tr> <tr> <td>0.9.1</td> <td>Integrate some review feedback</td> </tr> </tbody> </table></div> <h1 id="non-normative-front-matter"> <a href="#non-normative-front-matter" class="anchor-heading" aria-labelledby="non-normative-front-matter"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non-normative front matter </h1> <p>The contents of this section attempt to explain this specification with context and goals, but do not form a formal part of the specification itself.</p> <h2 id="summary"> <a href="#summary" class="anchor-heading" aria-labelledby="summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Summary </h2> <p>The goal of this specification is to define a protocol to expose Solana iOS and Android wallet app functionality (authorization and transaction signing) to dapps. It is optimized for use cases where the wallet app is running on a mobile device (Android or iOS), but does not preclude usage by wallets on a desktop OS (Linux, macOS, Windows, etc). This protocol is freely available to all Solana developers, and the intention is for this to become the standard for connecting all dapps to mobile wallet apps.</p> <h2 id="user-stories"> <a href="#user-stories" class="anchor-heading" aria-labelledby="user-stories"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User stories </h2> <p>These user stories outline the goals and user experiences that this protocol aims to enable.</p> <ol> <li>As a user, I want my phone to be a universal wallet for any transaction, regardless of where I am interacting with a dapp (i.e. on a single device, or on a different nearby device)</li> <li>As a user, I want my dapp transactions to be private and secure</li> <li>As a user, I want local dapp authorizations and transactions to be as simple as those I experience using the web-based wallet-adapter</li> <li>As a user, I want my authorization of a dapp by my wallet to be a one-time operation</li> <li>As a native dapp developer, I want my dapp to work with all native wallet apps</li> <li>As a web dapp developer, I want my mobile browser friendly dapp to work with all native wallet apps</li> <li>As a dapp or wallet app developer, I want permissively licensed open source reference implementations of the protocol to be available for my use</li> </ol> <h2 id="requirements"> <a href="#requirements" class="anchor-heading" aria-labelledby="requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Requirements </h2> <p>These requirements are derived from the user stories, and exist to guide specification design decisions.</p> <ol> <li> <p>All communication between dapps and wallet apps should take place over a secure channel.</p> <p><em>Rationale: this prevents transaction tampering and frontrunning.</em></p> </li> <li> <p>At least one transport mechanism should be a standard web technology (for e.g. HTTP/S, WebSockets, etc).</p> <p><em>Rationale: this supports using web-based dapps with native wallet apps.</em></p> </li> <li> <p>The protocol must support one or more mechanisms to exchange a shared token (for e.g., URI links, QR codes, NFC, BT, etc), which shall be used to establish the secure channel.</p> <p><em>Rationale: this protects against MITM attacks during secure channel establishment.</em></p> </li> <li> <p>At least one shared token exchange mechanism must be available to remote browser-based dapps (e.g. displaying a QR code).</p> <p><em>Rationale: this supports using remote dapps with native wallet apps.</em></p> </li> <li> <p>The shared token must be able to establish a secure channel an indefinite number of times.</p> <p><em>Rationale: this supports persistent dapp &lt;-&gt; wallet app connections after a one-time authorization.</em></p> </li> <li> <p>For communication between a dapp and native wallet app running on a single device, the protocol must not require the use of a remote communication intermediary (though this does not preclude the optional use of one, at the discretion of the dapp and/or wallet app).</p> <p><em>Rationale: a remote intermediate (such as a reflector server) increases both the communication latency and the attack surface (by intentionally introducing a 3rd party to communications).</em></p> </li> <li> <p>The protocol must support a mechanism (such as a custom URI scheme) that allows launching a native app from a mobile web browser on both Android and iOS.</p> <p><em>Rationale: the user should not be required to manually launch a wallet app for local wallet app interaction.</em></p> </li> <li> <p>The dapp must identify itself to the wallet app during authorization.</p> <p><em>Rationale: this allows the wallet app to give the user context about what they are authorizing.</em></p> </li> <li> <p>The reference implementation(s) of the protocol should be Apache 2.0 licensed, and made available on a public repository.</p> </li> </ol> <h1 id="specification"> <a href="#specification" class="anchor-heading" aria-labelledby="specification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Specification </h1> <h2 id="terminology"> <a href="#terminology" class="anchor-heading" aria-labelledby="terminology"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Terminology </h2> <p><em>association token</em> - a base64url encoding of an ECDSA public keypoint</p> <p><em>dapp endpoint</em> - an app implementing user-facing functionality (e.g. DeFi services, blockchain games, etc). This endpoint acts as both the initiator and the client in this protocol.</p> <p><em>reflector</em> - an intermediary which brokers connections between two endpoints, when they are unable to communicate directly themselves. It should be viewed as a potential adversary.</p> <p><em>wallet endpoint</em> - an app implementing wallet-like functionality (i.e. providing transaction signing services). This endpoint acts as the server in this protocol.</p> <h2 id="transport"> <a href="#transport" class="anchor-heading" aria-labelledby="transport"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Transport </h2> <h3 id="websockets"> <a href="#websockets" class="anchor-heading" aria-labelledby="websockets"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> WebSockets </h3> <p>WebSockets is a mandatory transport protocol for mobile-wallet-adapter implementations. Dapp endpoints must be able to act as a WebSocket client, and wallet endpoints must be able to act as either a WebSocket server or client (depending on whether the connection is local, or if a reflector is used, respectively).</p> <p>A WebSocket client API is available in all major browsers, enabling web-based dapps (both mobile and desktop) to use this transport.</p> <p>When connecting to a <a href="#local-uri">Local URI</a>, the dapp endpoint must request, and the wallet endpoint must respond with, the <code class="language-plaintext highlighter-rouge">com.solana.mobilewalletadapter.v1</code> WebSocket subprotocol. When connecting to a <a href="#remote-uri">Remote URI</a>, the both the dapp and wallet endpoints must request, and the reflector server must respond with, both the <code class="language-plaintext highlighter-rouge">com.solana.mobilewalletadapter.v1</code> and <code class="language-plaintext highlighter-rouge">com.solana.mobilewalletadapter.v1.reflector</code> WebSocket subprotocols.</p> <p>When the wallet endpoint is acting as a WebSocket server, it must send periodic <a href="https://datatracker.ietf.org/doc/html/rfc6455#section-5.5.2"><code class="language-plaintext highlighter-rouge">PING</code></a> frames to the dapp endpoint.</p> <h3 id="bluetooth-le"> <a href="#bluetooth-le" class="anchor-heading" aria-labelledby="bluetooth-le"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bluetooth LE </h3> <p>Bluetooth LE is an optional transport protocol for mobile-wallet-adapter implementations. It enforces a proximity requirement on the endpoints, which some users may find desirable from a security standpoint. It also eliminates the need for a reflector when connecting dapp and wallet endpoints running on different systems, removing an attack surface from the protocol.</p> <p>A Web Bluetooth client API is available in many browsers, enabling web-based dapps (both mobile and desktop) to use this transport.</p> <p>The details of this transport are not defined in this version of the mobile-wallet-adapter protocol. It is expected to be defined in a future protocol version.</p> <h2 id="association"> <a href="#association" class="anchor-heading" aria-labelledby="association"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Association </h2> <p>Association is the process of establishing a shared association identifier between a dapp endpoint and a wallet endpoint (with no requirement that these be running on the same system). An association is ephemeral - it persists only until the transport is disconnected. A new association is performed every time a dapp endpoint seeks to connect to a wallet endpoint.</p> <h3 id="association-keypair"> <a href="#association-keypair" class="anchor-heading" aria-labelledby="association-keypair"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Association keypair </h3> <p>The dapp endpoint should generate an ephemeral EC keypair on the P-256 curve, and encode the public keypoint Qa using the X9.62 public key format <code class="language-plaintext highlighter-rouge">(0x04 || x || y)</code>. This public keypoint is then base64url-encoded, and the resulting string is called the association token. The private keypoint for this keypair will be used during session establishment.</p> <h3 id="local-uri"> <a href="#local-uri" class="anchor-heading" aria-labelledby="local-uri"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Local URI </h3> <p>When running on Android or iOS, the dapp endpoint should first attempt to associate with a local wallet endpoint by opening a URI (either from within the browser for a web dapp, or directly from a native dapp) with the <code class="language-plaintext highlighter-rouge">solana-wallet:</code> scheme. The URI should be formatted as:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>solana-wallet:/v1/associate/local?association=&lt;association_token&gt;&amp;port=&lt;port_number&gt;
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">association_token</code> is as described above</li> <li><code class="language-plaintext highlighter-rouge">port_number</code> is a random number between 49152 and 65535</li> </ul> <p>Once the URI is opened, the dapp endpoint should attempt to connect to the local WebSocket address, <code class="language-plaintext highlighter-rouge">ws://localhost:&lt;port_number&gt;/solana-wallet</code>, and proceed to <a href="#session-establishment">Session establishment</a>.</p> <p>If the WebSocket transport is unavailable locally after no less than 30 seconds, the dapp endpoint should display user guidance (e.g. download a wallet) and optionally present the opportunity to connect to a remote wallet endpoint using one or more of the other association mechanisms.</p> <h4 id="android"> <a href="#android" class="anchor-heading" aria-labelledby="android"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Android </h4> <p>If a wallet endpoint is installed which has registered an Activity for this URI scheme and format, it will be launched. Upon launch via this URI, the wallet endpoint should start a WebSocket server on port <code class="language-plaintext highlighter-rouge">port_number</code> and begin listening for connections to <code class="language-plaintext highlighter-rouge">/solana-wallet</code> for no less than 10 seconds. This websocket server should only accept connections from the localhost.</p> <p>Whether launched from a web browser or a native dapp endpoint, the Intent’s action will be <a href="https://developer.android.com/reference/android/content/Intent#ACTION_VIEW"><code class="language-plaintext highlighter-rouge">android.intent.action.VIEW</code></a> and the category will be <a href="https://developer.android.com/reference/android/content/Intent#CATEGORY_BROWSABLE"><code class="language-plaintext highlighter-rouge">android.intent.category.BROWSABLE</code></a>. When launched by a web browser, no caller identity will be available, and as such, the referrer details available within the Intent cannot be used to verify the origin of the association. When launched by a native dapp endpoint, this Intent should be sent with <a href="https://developer.android.com/reference/android/app/Activity#startActivityForResult(android.content.Intent,%20int)"><code class="language-plaintext highlighter-rouge">startActivityForResult</code></a>, allowing the wallet endpoint to query the caller identity. The result returned to the calling dapp endpoint is not specified.</p> <h4 id="ios"> <a href="#ios" class="anchor-heading" aria-labelledby="ios"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> iOS </h4> <p><em>iOS support is planned for a future version of this specification</em></p> <h4 id="desktop"> <a href="#desktop" class="anchor-heading" aria-labelledby="desktop"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Desktop </h4> <p>Since desktop OSes do not generally allow launching an app with a URI, a dapp endpoint should not attempt to use this association scheme. One or more of the other association mechanisms should be utilized instead.</p> <h3 id="remote-uri"> <a href="#remote-uri" class="anchor-heading" aria-labelledby="remote-uri"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Remote URI </h3> <p>When running on a desktop OS, or when connecting to a local wallet endpoint fails, the dapp endpoint may present a URI suitable for connection via a <a href="#reflector-protocol">reflector WebSocket server</a>, which will reflect traffic between two parties. The URI should be formatted as:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>solana-wallet:/v1/associate/remote?association=&lt;association_token&gt;&amp;reflector=&lt;host_authority&gt;&amp;id=&lt;reflector_unique_id&gt;
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">association_token</code> is as described above</li> <li><code class="language-plaintext highlighter-rouge">host_authority</code> is the address of a publicly routable WebSocket server implementing the reflector protocol</li> <li><code class="language-plaintext highlighter-rouge">reflector_unique_id</code> is a number generated securely at random by the dapp endpoint, 0 ≤ n ≤ 2^53 - 1</li> </ul> <p>This URI should be provided to the wallet endpoint through an out-of-band mechanism, detailed in the subsections below. Each of the dapp and wallet endpoints should attempt to connect to the WebSocket address <code class="language-plaintext highlighter-rouge">wss://&lt;host_authority&gt;/reflect?id=&lt;reflector_unique_id&gt;</code>. On connection, each endpoint should wait for the <a href="#reflector-protocol">Reflector protocol</a> to signal that the counterparty endpoint has connected.</p> <p>The dapp endpoint must wait no less than 30 seconds for reflection to commence. The wallet endpoint must wait no less than 10 seconds for reflection to commence. If it does not commence, the endpoints will disconnect and present appropriate error messages to the user.</p> <h4 id="qr-codes"> <a href="#qr-codes" class="anchor-heading" aria-labelledby="qr-codes"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> QR codes </h4> <p>Dapp endpoints must support displaying the remote URI to the user encoded as a QR code. After displaying a QR code, the dapp endpoint should connect to the specified reflector. Wallet endpoints on devices with a camera should support scanning QR codes within the app, receiving notifications from the system that a QR code encoding a remote URI has been received, or both. Upon receipt of a remote URI from a scanned QR code, the wallet endpoint should attempt to connect to the specified reflector.</p> <h4 id="clipboard"> <a href="#clipboard" class="anchor-heading" aria-labelledby="clipboard"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Clipboard </h4> <p>Dapp endpoints may optionally also support copying the remote URI to the system clipboard. After copying the remote URI to the clipboard, the dapp endpoint should connect to the specified reflector. Wallet endpoints on desktop OSes should provide a method to accept a remote URI from the system clipboard. Upon receipt of a remote URI from the system clipboard, the wallet endpoint should attempt to connect to the specified reflector.</p> <h3 id="endpoint-specific-uris"> <a href="#endpoint-specific-uris" class="anchor-heading" aria-labelledby="endpoint-specific-uris"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Endpoint-specific URIs </h3> <p>During <a href="#session-establishment">Session Establishment</a>, the wallet endpoint may return a URI prefix to use for future association attempts. This is expected to be used with <a href="https://developer.android.com/training/app-links">App Links</a> or <a href="https://developer.apple.com/ios/universal-links/">Universal Links</a>, to ensure that the desired wallet app is launched by the dapp. A dapp should reject URI prefixes with schemes other than <code class="language-plaintext highlighter-rouge">https:</code> for security reasons. If a dapp has been informed of a URI prefix for a wallet, it should use it with the same path elements and parameters provided as for the <code class="language-plaintext highlighter-rouge">solana-wallet:</code> URI scheme. For e.g., if an Android wallet endpoint handles App Links for solanaexamplewallet.io, it could provide a prefix of:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://solanaexamplewallet.io/mobilewalletadapter
</code></pre></div></div> <p>The dapp endpoint would then assemble the following URI to begin association with that wallet locally:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://solanaexamplewallet.io/mobilewalletadapter/v1/associate/local?association=&lt;association_token&gt;&amp;port=&lt;port_number&gt;
</code></pre></div></div> <p>All other aspects of associating are identical to those specified in the relevant preceding section.</p> <h3 id="bluetooth-le-1"> <a href="#bluetooth-le-1" class="anchor-heading" aria-labelledby="bluetooth-le-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Bluetooth LE </h3> <p>Bluetooth LE session establishment is not defined in this version of the mobile-wallet-adapter protocol. It is expected to be defined in a future protocol version.</p> <h2 id="session-establishment"> <a href="#session-establishment" class="anchor-heading" aria-labelledby="session-establishment"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Session establishment </h2> <h3 id="app_ping"> <a href="#app_ping" class="anchor-heading" aria-labelledby="app_ping"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> APP_PING </h3> <p>While the expectation is that the WebSocket server be responsible for periodically issuing <a href="https://datatracker.ietf.org/doc/html/rfc6455#section-5.5.2"><code class="language-plaintext highlighter-rouge">PING</code>s</a> to the client endpoint, the introduction of a reflector adds a requirement that the endpoints need to be notified when the counterparty is available.</p> <p>An <code class="language-plaintext highlighter-rouge">APP_PING</code> is an empty message. It is sent by the reflector to each endpoint when both endpoints have connected to the reflector. On first connecting to a reflector, the endpoints should wait to receive this message before initiating any communications. After any other message has been received, the <code class="language-plaintext highlighter-rouge">APP_PING</code> message becomes a no-op, and should be ignored.</p> <h3 id="hello_req"> <a href="#hello_req" class="anchor-heading" aria-labelledby="hello_req"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> HELLO_REQ </h3> <h4 id="direction"> <a href="#direction" class="anchor-heading" aria-labelledby="direction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Direction </h4> <p>Dapp endpoint to wallet endpoint</p> <h4 id="specification-1"> <a href="#specification-1" class="anchor-heading" aria-labelledby="specification-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Specification </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Qd&gt;&lt;Sa&gt;
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">Qd</code>: the X9.62-encoded dapp endpoint ephemeral ECDH public keypoint</li> <li><code class="language-plaintext highlighter-rouge">Sa</code>: a P1363-encoded ECDSA-SHA256 signature of Qd using the <a href="#association-keypair">association keypair</a></li> </ul> <h4 id="description"> <a href="#description" class="anchor-heading" aria-labelledby="description"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h4> <p>The <code class="language-plaintext highlighter-rouge">HELLO_REQ</code> message is the first message sent after a connection is established between the endpoints, and begins a Diffie-Hellman-Merkle key exchange. The dapp endpoint generates an ephemeral P-256 EC keypair and X9.62-encodes the public keypoint <code class="language-plaintext highlighter-rouge">Qd</code>. This encoded public keypoint is then ECDSA-SHA256-signed with the private keypoint of the <a href="#association-keypair">association keypair</a>, and the P1363-encoded signature appended to the encoded <code class="language-plaintext highlighter-rouge">Qd</code> public keypoint to form the HELLO_REQ message. The private keypoint of the P-256 EC keypair is retained for use on receipt of the <code class="language-plaintext highlighter-rouge">HELLO_RSP</code> message.</p> <p>On receipt, the wallet endpoint should verify the signature of <code class="language-plaintext highlighter-rouge">Qd</code> using the association token. If signature verification is successful, the wallet endpoint should prepare and send a <code class="language-plaintext highlighter-rouge">HELLO_RSP</code> message to the dapp endpoint.</p> <p>If qd signature verification fails, if no <code class="language-plaintext highlighter-rouge">HELLO_REQ</code> message is received by the wallet endpoint within no less than 10 seconds, or if a second <code class="language-plaintext highlighter-rouge">HELLO_REQ</code> message is received by the wallet endpoint at any time during the connection, all ephemeral key materials should be discarded, and the connection should be closed.</p> <h3 id="hello_rsp"> <a href="#hello_rsp" class="anchor-heading" aria-labelledby="hello_rsp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> HELLO_RSP </h3> <h4 id="direction-1"> <a href="#direction-1" class="anchor-heading" aria-labelledby="direction-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Direction </h4> <p>Wallet endpoint to dapp endpoint</p> <h4 id="specification-2"> <a href="#specification-2" class="anchor-heading" aria-labelledby="specification-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Specification </h4> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Qw&gt;
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">Qw</code>: the X9.62-encoded wallet endpoint ephemeral ECDH public keypoint</li> </ul> <h4 id="description-1"> <a href="#description-1" class="anchor-heading" aria-labelledby="description-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h4> <p>In response to a valid <code class="language-plaintext highlighter-rouge">HELLO_REQ</code> message to the wallet endpoint (which should be the first message received after a connection is established between the endpoints), it should generate a P-256 EC keypair and X9.62-encode the public keypoint <code class="language-plaintext highlighter-rouge">Qw</code>. This encoded public keypoint <code class="language-plaintext highlighter-rouge">Qw</code> forms the <code class="language-plaintext highlighter-rouge">HELLO_RSP</code> message.</p> <p>Upon sending of the <code class="language-plaintext highlighter-rouge">HELLO_RSP</code> message by the wallet endpoint, and receipt of the <code class="language-plaintext highlighter-rouge">HELLO_RSP</code> message by the dapp endpoint, each endpoint is now in possession of all necessary key materials to generate a shared secret for the <a href="#encrypted-message-wrapping">chosen encryption algorithm</a>, using the ECDH (as specified by <a href="https://csrc.nist.gov/publications/detail/sp/800-56a/rev-3/final">NIST SP 800-56A</a>) and HKDF (as specified by <a href="https://datatracker.ietf.org/doc/html/rfc5869">RFC5869</a>) algorithms with the following KDF parameters:</p> <ul> <li><code class="language-plaintext highlighter-rouge">ikm</code>: the 32-byte ECDH-derived secret</li> <li><code class="language-plaintext highlighter-rouge">salt</code>: the 65 byte X9.62-encoded public keypoint Qa of the <a href="#association-keypair">association keypair</a></li> <li><code class="language-plaintext highlighter-rouge">L</code>: 16 bytes (such that the output of the HKDF may be used directly as an AES-128 key)</li> </ul> <p>Once each endpoint has calculated the ephemeral shared secret, they should proceed to providing or consuming the <a href="#wallet-rpc-interface">Wallet RPC interface</a>.</p> <p>If either public keypoint <code class="language-plaintext highlighter-rouge">Qd</code> or <code class="language-plaintext highlighter-rouge">Qw</code> is not valid, if no <code class="language-plaintext highlighter-rouge">HELLO_RSP</code> message is received by the dapp endpoint within no less than 10 seconds, or if a second <code class="language-plaintext highlighter-rouge">HELLO_RSP</code> message is received by the dapp endpoint at any time during the connection, all ephemeral key materials should be discarded, and the connection should be closed.</p> <h2 id="wallet-rpc-interface"> <a href="#wallet-rpc-interface" class="anchor-heading" aria-labelledby="wallet-rpc-interface"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Wallet RPC interface </h2> <h3 id="operation"> <a href="#operation" class="anchor-heading" aria-labelledby="operation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Operation </h3> <p>After <a href="#session-establishment">session establishment</a> completes, the wallet endpoint is ready to accept <a href="https://www.jsonrpc.org/specification">JSON-RPC 2.0</a> non-privileged method calls from the dapp endpoint. To invoke privileged methods, a dapp endpoint must first put the session into an authorized state via either an <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> or a <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a> method call. For details on how a session enters and exits an authorized state, see the <a href="#non-privileged-methods">non-privileged methods</a>.</p> <h3 id="encrypted-message-wrapping"> <a href="#encrypted-message-wrapping" class="anchor-heading" aria-labelledby="encrypted-message-wrapping"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Encrypted message wrapping </h3> <p>After the <a href="#session-establishment">session establishment</a> process completes, every message received by an endpoint is expected to be encrypted with AES-128-GCM (as specified by <a href="https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf">NIST SP 800-38D</a>). The sending endpoint should prepare the encrypted message by concatenating:</p> <ul> <li>the message sequence number, a 4-byte big-endian unsigned integer</li> <li>a random 12-byte IV (which should be newly generated for each encrypted message)</li> <li>the AES-128-GCM message ciphertext, encrypted using the private key created during <a href="#session-establishment">session establishment</a> and the random IV, and including the 4-byte message sequence number as additional authorized data (AAD)</li> <li>the 16-byte authentication tag generated during AES-128-GCM encryption</li> </ul> <p>After decrypting the ciphertext with the shared secret generated during <a href="#session-establishment">session establishment</a> and verifying the authentication tag, the receiving endpoint should further interpret it as a <a href="https://www.jsonrpc.org/specification">JSON-RPC 2.0</a> message.</p> <p>The message sequence number is monotonically increasing, and starts at 1 when session establishment completes. Each endpoint maintains its own independent sequence number, and increments it by 1 each time an encrypted message is created and sent. On receipt of an encrypted message, each endpoint should verify that the sequence number is 1 greater than that of the previous message received (other than for the first message received). On receipt of a message with a sequence number set to anything other than the expected next value, the encrypted message should be discarded and the connection closed.</p> <h4 id="non-normative-commentary"> <a href="#non-normative-commentary" class="anchor-heading" aria-labelledby="non-normative-commentary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non-normative commentary </h4> <p>Why does the protocol specify this, rather than rely on, e.g., TLS?</p> <ul> <li>In remote usage, a reflector server is used to mediate a connection between a dapp and wallet endpoint. This reflector is viewed as an adversary, and so should not have access to the plaintext of endpoint communications.</li> <li>This protocol supports multiple transports (i.e. <code class="language-plaintext highlighter-rouge">ws:</code> for local connections, <code class="language-plaintext highlighter-rouge">wss:</code> for reflector connections, Bluetooth LE for wireless connections). Each of these has different confidentiality and authenticity guarantees. By encrypting messages at the application layer, the protocol can provide a uniform minimum security guarantee for a heterogeneous set of transports.</li> </ul> <h3 id="non-privileged-methods"> <a href="#non-privileged-methods" class="anchor-heading" aria-labelledby="non-privileged-methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non-privileged methods </h3> <p>Non-privileged methods do not require the current session to be in an authorized state to invoke them (though they may still accept an <code class="language-plaintext highlighter-rouge">auth_token</code> to provide their functionality).</p> <h4 id="authorize"> <a href="#authorize" class="anchor-heading" aria-labelledby="authorize"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> authorize </h4> <h5 id="json-rpc-method-specification"> <a href="#json-rpc-method-specification" class="anchor-heading" aria-labelledby="json-rpc-method-specification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON-RPC method specification </h5> <h6 class="no_toc" id="method"> <a href="#method" class="anchor-heading" aria-labelledby="method"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>authorize
</code></pre></div></div> <h6 class="no_toc" id="params"> <a href="#params" class="anchor-heading" aria-labelledby="params"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “identity”: {
        “uri”: “&lt;dapp_uri&gt;”,
        “icon”: “&lt;dapp_icon_relative_path&gt;”,
        “name”: “&lt;dapp_name&gt;”,
    },
    "cluster": "&lt;cluster&gt;",
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">identity</code>: a JSON object, containing: <ul> <li><code class="language-plaintext highlighter-rouge">uri</code>: (optional) a URI representing the web address associated with the dapp endpoint making this authorization request. If present, it must be an absolute, hierarchical URI.</li> <li><code class="language-plaintext highlighter-rouge">icon</code>: (optional) a relative path (from <code class="language-plaintext highlighter-rouge">uri</code>) to an image asset file of an icon identifying the dapp endpoint making this authorization request</li> <li><code class="language-plaintext highlighter-rouge">name</code>: (optional) the display name for this dapp endpoint</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">cluster</code>: (optional) if set, the Solana network cluster with which the dapp endpoint intends to interact; supported values include <code class="language-plaintext highlighter-rouge">mainnet-beta</code>, <code class="language-plaintext highlighter-rouge">testnet</code>, <code class="language-plaintext highlighter-rouge">devnet</code>. If not set, defaults to <code class="language-plaintext highlighter-rouge">mainnet-beta</code>.</li> </ul> <h6 class="no_toc" id="result"> <a href="#result" class="anchor-heading" aria-labelledby="result"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “auth_token”: “&lt;auth_token&gt;”,
    “accounts”: [
        {“address”: “&lt;address&gt;", “label”: “&lt;label&gt;”},
        ...
    ],
    “wallet_uri_base”: “&lt;wallet_uri_base&gt;”,
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">auth_token</code>: an opaque string representing a unique identifying token issued by the wallet endpoint to the dapp endpoint. The format and contents are an implementation detail of the wallet endpoint. The dapp endpoint can use this on future connections to <code class="language-plaintext highlighter-rouge">reauthorize</code> access to <a href="#privileged-methods">privileged methods</a>.</li> <li><code class="language-plaintext highlighter-rouge">accounts</code>: one or more value objects that represent the accounts to which this auth token corresponds. These objects hold the following properties: <ul> <li><code class="language-plaintext highlighter-rouge">address</code>: a base64-encoded address for this account</li> <li><code class="language-plaintext highlighter-rouge">label</code>: (optional) a human-readable string that describes the account. Wallet endpoints that allow their users to label their accounts may choose to return those labels here to enhance the user experience at the dapp endpoint.</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">wallet_uri_base</code>: (optional) if this wallet endpoint has an <a href="#endpoint-specific-uris">endpoint-specific URI</a> that the dapp endpoint should use for subsequent connections, this member will be included in the result object. The dapp endpoint should use this URI for all subsequent connections where it expects to use this <code class="language-plaintext highlighter-rouge">auth_token</code>.</li> </ul> <h6 class="no_toc" id="errors"> <a href="#errors" class="anchor-heading" aria-labelledby="errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <ul> <li><code class="language-plaintext highlighter-rouge">-32602</code> (Invalid params) if the params object does not match the format defined above</li> <li><code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code> if the wallet endpoint did not authorize access to the requested privileged methods</li> <li><code class="language-plaintext highlighter-rouge">ERROR_CLUSTER_NOT_SUPPORTED</code> if the wallet endpoint does not support the requested Solana cluster</li> </ul> <h5 id="description-2"> <a href="#description-2" class="anchor-heading" aria-labelledby="description-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h5> <p>This method allows the dapp endpoint to request authorization from the wallet endpoint for access to <a href="#privileged-methods">privileged methods</a>. On success, it returns an <code class="language-plaintext highlighter-rouge">auth_token</code> providing access to privileged methods, along with addresses and optional labels for all authorized accounts. It may also return a URI suitable for future use as an <a href="#endpoint-specific-uris">endpoint-specific URI</a>. After a successful call to <code class="language-plaintext highlighter-rouge">authorize</code>, the current session will be placed into an authorized state, with privileges associated with the returned <code class="language-plaintext highlighter-rouge">auth_token</code>. On failure, the current session with be placed into the unauthorized state.</p> <p>The returned <code class="language-plaintext highlighter-rouge">auth_token</code> is an opaque string with meaning only to the wallet endpoint which created it. It is recommended that the wallet endpoint include a mechanism to authenticate the contents of auth tokens it issues (for e.g., with an HMAC, or by encryption with a secret symmetric key). This <code class="language-plaintext highlighter-rouge">auth_token</code> may be used to <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a> future sessions between these dapp and wallet endpoints.</p> <p>Dapp endpoints should make every effort possible to <a href="#dapp-identity-verification">verify the authenticity</a> of the presented identity. While the <code class="language-plaintext highlighter-rouge">uri</code> parameter is optional, it is strongly recommended - without it, the wallet endpoint may not be able to verify the authenticity of the dapp.</p> <p>The <code class="language-plaintext highlighter-rouge">cluster</code> parameter allows the dapp endpoint to select a specific Solana cluster with which to interact. This is relevant for both <a href="#sign_transactions"><code class="language-plaintext highlighter-rouge">sign_transactions</code></a>, where a wallet may refuse to sign transactions without a currently valid blockhash, and for <a href="#sign_and_send_transactions"><code class="language-plaintext highlighter-rouge">sign_and_send_transactions</code></a>, where the wallet endpoint must know which cluster to submit the transactions to. This parameter would normally be used to select a cluster other than <code class="language-plaintext highlighter-rouge">mainnet-beta</code> for dapp development and testing purposes. Under normal circumstances, this field should be omitted, in which case the wallet endpoint will interact with the <code class="language-plaintext highlighter-rouge">mainnet-beta</code> cluster.</p> <h4 id="deauthorize"> <a href="#deauthorize" class="anchor-heading" aria-labelledby="deauthorize"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> deauthorize </h4> <h5 id="json-rpc-method-specification-1"> <a href="#json-rpc-method-specification-1" class="anchor-heading" aria-labelledby="json-rpc-method-specification-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON-RPC method specification </h5> <h6 class="no_toc" id="method-1"> <a href="#method-1" class="anchor-heading" aria-labelledby="method-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deauthorize
</code></pre></div></div> <h6 class="no_toc" id="params-1"> <a href="#params-1" class="anchor-heading" aria-labelledby="params-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “auth_token”: “&lt;auth_token&gt;”,
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">auth_token</code>: an opaque string previously returned by a call to <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a>, <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a>, or <a href="#clone_authorization"><code class="language-plaintext highlighter-rouge">clone_authorization</code></a></li> </ul> <h6 class="no_toc" id="result-1"> <a href="#result-1" class="anchor-heading" aria-labelledby="result-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{}
</code></pre></div></div> <h6 class="no_toc" id="errors-1"> <a href="#errors-1" class="anchor-heading" aria-labelledby="errors-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <ul> <li><code class="language-plaintext highlighter-rouge">-32602</code> (Invalid params) if the params object does not match the format defined above</li> </ul> <h5 id="description-3"> <a href="#description-3" class="anchor-heading" aria-labelledby="description-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h5> <p>This method will make the provided <code class="language-plaintext highlighter-rouge">auth_token</code> invalid for use (if it ever was valid). To avoid disclosure, this method will not indicate whether the <code class="language-plaintext highlighter-rouge">auth_token</code> was previously valid to the caller.</p> <p>If, during the current session, the specified auth token was returned by the most recent call to <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> or <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a>, the session with be placed into the unauthorized state.</p> <h4 id="reauthorize"> <a href="#reauthorize" class="anchor-heading" aria-labelledby="reauthorize"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> reauthorize </h4> <h5 id="json-rpc-method-specification-2"> <a href="#json-rpc-method-specification-2" class="anchor-heading" aria-labelledby="json-rpc-method-specification-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON-RPC method specification </h5> <h6 class="no_toc" id="method-2"> <a href="#method-2" class="anchor-heading" aria-labelledby="method-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reauthorize
</code></pre></div></div> <h6 class="no_toc" id="params-2"> <a href="#params-2" class="anchor-heading" aria-labelledby="params-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “identity”: {
        “uri”: “&lt;dapp_uri&gt;”,
        “icon”: “&lt;dapp_icon_relative_path&gt;”,
        “name”: “&lt;dapp_name&gt;”,
    },
    “auth_token”: “&lt;auth_token&gt;”,
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">identity</code>: as defined for <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a></li> <li><code class="language-plaintext highlighter-rouge">auth_token</code>: an opaque string previously returned by a call to <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a>, <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a>, or <a href="#clone_authorization"><code class="language-plaintext highlighter-rouge">clone_authorization</code></a></li> </ul> <h6 class="no_toc" id="result-2"> <a href="#result-2" class="anchor-heading" aria-labelledby="result-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “auth_token”: “&lt;auth_token&gt;”,
    “accounts”: [
        {“address”: “&lt;address&gt;", “label”: “&lt;label&gt;”},
        ...
    ],
    “wallet_uri_base”: “&lt;wallet_uri_base&gt;”,
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">auth_token</code>: as defined for <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a></li> <li><code class="language-plaintext highlighter-rouge">accounts</code>: as defined for <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a></li> <li><code class="language-plaintext highlighter-rouge">wallet_uri_base</code>: as defined for <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a></li> </ul> <h6 class="no_toc" id="errors-2"> <a href="#errors-2" class="anchor-heading" aria-labelledby="errors-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <ul> <li><code class="language-plaintext highlighter-rouge">-32602</code> (Invalid params) if the params object does not match the format defined above</li> <li><code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code> if the wallet endpoint declined to authorize the current session with <code class="language-plaintext highlighter-rouge">auth_token</code> for any reason</li> </ul> <h5 id="description-4"> <a href="#description-4" class="anchor-heading" aria-labelledby="description-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h5> <p>This method attempts to put the current session in an authorized state, with privileges associated with the specified <code class="language-plaintext highlighter-rouge">auth_token</code>.</p> <p>On success, the current session will be placed into an authorized state. Additionally, updated values for <code class="language-plaintext highlighter-rouge">auth_token</code>, <code class="language-plaintext highlighter-rouge">accounts</code>, and/or <code class="language-plaintext highlighter-rouge">wallet_uri_base</code> will be returned. These may differ from those originally provided in the <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> response for this auth token; if so, they override any previous values for these parameters. The prior values should be discarded and not reused. This allows a wallet endpoint to update the auth token used by the dapp endpoint, or to modify the set of authorized account addresses or their labels without requiring the dapp endpoint to restart the authorization process.</p> <p>If the result is <code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code>, this auth token cannot be reused, and should be discarded. The dapp endpoint should request a new token with the <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> method. The session with be placed into the unauthorized state.</p> <h5 id="non-normative-commentary-1"> <a href="#non-normative-commentary-1" class="anchor-heading" aria-labelledby="non-normative-commentary-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non-normative commentary </h5> <p><code class="language-plaintext highlighter-rouge">reauthorize</code> is intended to be a lightweight operation, as compared to <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a>. It normally should not present any UI to the user, but instead perform only the subset of dapp endpoint identity checks that can be performed quickly and without user intervention. The intent is to quickly verify that an auth token remains valid for use by this dapp endpoint. If verification fails for any reason, the wallet endpoint should report <code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code> to the dapp endpoint, which would then discard the stored auth token and begin authorization from scratch with a new call to <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a>.</p> <p>Wallet endpoints should balance the responsibility for performing these identity checks against their latency impact. For example, a wallet endpoint may choose to accept an auth token issued in the last several minutes without performing any additional checks, but require dapp endpoint identity checks to be performed for an auth token that was issued before then. This facilitates multiple <a href="#session-establishment">sessions to be established</a> in a short timespan, related to the same user interaction with a dapp endpoint. The auth token validity policy is a competency of the wallet endpoint, and dictating any specific auth token lifespan or timeout is outside the scope of this protocol specification. However, it is strongly recommended that wallet endpoints do not issue auth tokens with unlimited lifespans or for which dapp endpoint identity checks are never performed on <code class="language-plaintext highlighter-rouge">reauthorize</code>.</p> <h4 id="get_capabilities"> <a href="#get_capabilities" class="anchor-heading" aria-labelledby="get_capabilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> get_capabilities </h4> <h5 id="json-rpc-method-specification-3"> <a href="#json-rpc-method-specification-3" class="anchor-heading" aria-labelledby="json-rpc-method-specification-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON-RPC method specification </h5> <h6 class="no_toc" id="method-3"> <a href="#method-3" class="anchor-heading" aria-labelledby="method-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get_capabilities
</code></pre></div></div> <h6 class="no_toc" id="params-3"> <a href="#params-3" class="anchor-heading" aria-labelledby="params-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{}
</code></pre></div></div> <h6 class="no_toc" id="result-3"> <a href="#result-3" class="anchor-heading" aria-labelledby="result-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "supports_clone_authorization": &lt;supports_clone_authorization&gt;,
    "supports_sign_and_send_transactions": &lt;supports_sign_and_send_transactions&gt;,
    "max_transactions_per_request": &lt;max_transactions_per_request&gt;,
    "max_messages_per_request": &lt;max_messages_per_request&gt;,
    "supported_transaction_versions": [&lt;supported_transaction_versions&gt;, ...]
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">supports_clone_authorization</code>: <code class="language-plaintext highlighter-rouge">true</code> if the <a href="#clone_authorization"><code class="language-plaintext highlighter-rouge">clone_authorization</code></a> method is supported, otherwise <code class="language-plaintext highlighter-rouge">false</code></li> <li><code class="language-plaintext highlighter-rouge">supports_sign_and_send_transactions</code>: <code class="language-plaintext highlighter-rouge">true</code> if the <a href="#sign_and_send_transactions"><code class="language-plaintext highlighter-rouge">sign_and_send_transactions</code></a> method is supported, otherwise <code class="language-plaintext highlighter-rouge">false</code></li> <li><code class="language-plaintext highlighter-rouge">max_transactions_per_request</code>: (optional) if present, the max number of transaction payloads which can be signed by a single <a href="#sign_transactions"><code class="language-plaintext highlighter-rouge">sign_transactions</code></a> or <a href="#sign_and_send_transactions"><code class="language-plaintext highlighter-rouge">sign_and_send_transactions</code></a> request. If absent, the implementation doesn’t publish a specific limit for this parameter.</li> <li><code class="language-plaintext highlighter-rouge">max_messages_per_request</code>: (optional) if present, the max number of transaction payloads which can be signed by a single <a href="#sign_messages"><code class="language-plaintext highlighter-rouge">sign_messages</code></a> request. If absent, the implementation doesn’t publish a specific limit for this parameter.</li> <li><code class="language-plaintext highlighter-rouge">supported_transaction_versions</code>: the Solana network transaction formats supported by this wallet endpoint. Allowed values are those defined for <a href="https://solana-labs.github.io/solana-web3.js/modules.html#TransactionVersion"><code class="language-plaintext highlighter-rouge">TransactionVersion</code></a> (for e.g., <code class="language-plaintext highlighter-rouge">"legacy"</code>, <code class="language-plaintext highlighter-rouge">0</code>, etc).</li> </ul> <h6 class="no_toc" id="errors-3"> <a href="#errors-3" class="anchor-heading" aria-labelledby="errors-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <ul> <li><code class="language-plaintext highlighter-rouge">-32602</code> (Invalid params) if the params object does not match the format defined above</li> </ul> <h5 id="description-5"> <a href="#description-5" class="anchor-heading" aria-labelledby="description-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h5> <p>This method can be used to enumerate the capabilities and limits of a wallet endpoint’s implementation of this specification. It returns whether optional specification features are supported, as well as any implementation-specific limits.</p> <h3 id="privileged-methods"> <a href="#privileged-methods" class="anchor-heading" aria-labelledby="privileged-methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Privileged methods </h3> <p>Privileged methods require the current session to be in an authorized state to invoke them. For details on how a session enters and exits an authorized state, see the <a href="#non-privileged-methods">non-privileged methods</a>.</p> <h4 id="sign_transactions"> <a href="#sign_transactions" class="anchor-heading" aria-labelledby="sign_transactions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sign_transactions </h4> <h5 id="json-rpc-method-specification-4"> <a href="#json-rpc-method-specification-4" class="anchor-heading" aria-labelledby="json-rpc-method-specification-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON-RPC method specification </h5> <h6 class="no_toc" id="method-4"> <a href="#method-4" class="anchor-heading" aria-labelledby="method-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sign_transactions
</code></pre></div></div> <h6 class="no_toc" id="params-4"> <a href="#params-4" class="anchor-heading" aria-labelledby="params-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “payloads”: [“&lt;transaction&gt;”, ...],
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">payloads</code>: one or more base64-encoded transaction payloads to sign</li> </ul> <h6 class="no_toc" id="result-4"> <a href="#result-4" class="anchor-heading" aria-labelledby="result-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “signed_payloads”: [“&lt;signed_transaction&gt;”, ...],
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">signed_payloads</code>: the corresponding base64-encoded signed transaction payloads</li> </ul> <h6 class="no_toc" id="errors-4"> <a href="#errors-4" class="anchor-heading" aria-labelledby="errors-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <ul> <li><code class="language-plaintext highlighter-rouge">-32602</code> (Invalid params) if the params object does not match the format defined above</li> <li><code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code> if the current session is in the unauthorized state, either because <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> or <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a> has not been invoked for the current session, or because the current session’s authorization has been revoked by the wallet endpoint</li> <li> <p><code class="language-plaintext highlighter-rouge">ERROR_INVALID_PAYLOADS</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>“data”: {
    “valid”: [&lt;transaction_valid&gt;, ...],
}
</code></pre></div> </div> <p>if any transaction does not represent a valid transaction for signing, where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">valid</code>: an array of booleans with the same length as payloads indicating which are valid</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">ERROR_NOT_SIGNED</code> if the wallet endpoint declined to sign these transactions for any reason</li> <li><code class="language-plaintext highlighter-rouge">ERROR_TOO_MANY_PAYLOADS</code> if the wallet endpoint is unable to sign all transactions due to exceeding implementation limits. These limits may be available via <a href="#get_capabilities"><code class="language-plaintext highlighter-rouge">get_capabilities</code></a>.</li> </ul> <h5 id="description-6"> <a href="#description-6" class="anchor-heading" aria-labelledby="description-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h5> <p>The wallet endpoint should attempt to simulate the transactions provided by data and present them to the user for approval (if applicable). If approved (or if it does not require approval), the wallet endpoint should sign the transactions with the private keys for the requested authorized account addresses, and return the signed transactions to the dapp endpoint.</p> <h4 id="sign_and_send_transactions"> <a href="#sign_and_send_transactions" class="anchor-heading" aria-labelledby="sign_and_send_transactions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sign_and_send_transactions </h4> <h5 id="json-rpc-method-specification-5"> <a href="#json-rpc-method-specification-5" class="anchor-heading" aria-labelledby="json-rpc-method-specification-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON-RPC method specification </h5> <h6 class="no_toc" id="method-5"> <a href="#method-5" class="anchor-heading" aria-labelledby="method-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sign_and_send_transactions
</code></pre></div></div> <h6 class="no_toc" id="params-5"> <a href="#params-5" class="anchor-heading" aria-labelledby="params-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “payloads”: [“&lt;transaction&gt;”, ...],
    "options": {
        “min_context_slot”: &lt;min_context_slot&gt;,
    }
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">payloads</code>: one or more base64-encoded transaction payload to sign</li> <li><code class="language-plaintext highlighter-rouge">options</code>: (optional) a JSON object, containing: <ul> <li><code class="language-plaintext highlighter-rouge">min_context_slot</code>: (optional) if set, the minimum slot number at which to perform preflight transaction checks</li> </ul> </li> </ul> <h6 class="no_toc" id="result-5"> <a href="#result-5" class="anchor-heading" aria-labelledby="result-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “signatures”: [“&lt;transaction_signature&gt;”, ...],
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">signatures</code>: the corresponding base64-encoded transaction signatures</li> </ul> <h6 class="no_toc" id="errors-5"> <a href="#errors-5" class="anchor-heading" aria-labelledby="errors-5"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <ul> <li><code class="language-plaintext highlighter-rouge">-32602</code> (Invalid params) if the params object does not match the format defined above</li> <li><code class="language-plaintext highlighter-rouge">-32601</code> (Method not found) if <code class="language-plaintext highlighter-rouge">sign_and_send_transactions</code> is not supported by this wallet endpoint</li> <li><code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code> if the current session is in the unauthorized state, either because <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> or <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a> has not been invoked for the current session, or because the current session’s authorization has been revoked by the wallet endpoint</li> <li> <p><code class="language-plaintext highlighter-rouge">ERROR_INVALID_PAYLOADS</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>“data”: {
    “valid”: [&lt;transaction_valid&gt;, ...]
}
</code></pre></div> </div> <p>if any transaction does not represent a valid transaction for signing, where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">transaction_valid</code>: an array of booleans with the same length as <code class="language-plaintext highlighter-rouge">payloads</code> indicating which are valid</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">ERROR_NOT_SIGNED</code> if the wallet endpoint declined to sign this transaction for any reason</li> <li> <p><code class="language-plaintext highlighter-rouge">ERROR_NOT_SUBMITTED</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>“data”: {
    “signatures”: [“&lt;transaction_signature&gt;”, ...],
}
</code></pre></div> </div> <p>if the wallet endpoint was unable to submit one or more of the signed transactions to the network, where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">signatures</code>: the corresponding base64-encoded transaction signatures for transactions which were successfully sent to the network, or <code class="language-plaintext highlighter-rouge">null</code> for transactions which were unable to be submitted to the network for any reason</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">ERROR_TOO_MANY_PAYLOADS</code> if the wallet endpoint is unable to sign all transactions due to exceeding implementation limits. These limits may be available via <a href="#get_capabilities"><code class="language-plaintext highlighter-rouge">get_capabilities</code></a>.</li> </ul> <h5 id="description-7"> <a href="#description-7" class="anchor-heading" aria-labelledby="description-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h5> <p><em>Implementation of this method by a wallet endpoint is optional.</em></p> <p>The wallet endpoint should attempt to simulate the transactions provided by <code class="language-plaintext highlighter-rouge">payloads</code> and present them to the user for approval (if applicable). If approved (or if it does not require approval), the wallet endpoint should verify the transactions, sign them with the private keys for the authorized addresses, submit them to the network, and return the transaction signatures to the dapp endpoint.</p> <p><code class="language-plaintext highlighter-rouge">options</code> allows customization of how the wallet endpoint processes the transactions it sends to the Solana network. If specified, <code class="language-plaintext highlighter-rouge">min_context_slot</code> specifies the minimum slot number that the transactions should be evaluated at. This allows the wallet endpoint to wait for its network RPC node to reach the same point in time as the node used by the dapp endpoint, ensuring that, e.g., the recent blockhash encoded in the transactions will be available.</p> <h6 id="non-normative-commentary-2"> <a href="#non-normative-commentary-2" class="anchor-heading" aria-labelledby="non-normative-commentary-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non-normative commentary </h6> <p>This method is optional, to support signing-only wallet endpoints which do not have any form of network connectivity.</p> <p>it does not allow the dapp endpoint to specify the network RPC server to submit the transaction to; that is at the discretion of the wallet endpoint. If this is a detail that matters to the dapp endpoint, it should instead use the <code class="language-plaintext highlighter-rouge">sign_transactions</code> method and submit the transaction to a network RPC server of its choosing.</p> <p>It is recommended that dapp endpoints verify that each transaction reached an appropriate level of commitment (typically either <code class="language-plaintext highlighter-rouge">confirmed</code> or <code class="language-plaintext highlighter-rouge">finalized</code>).</p> <h4 id="sign_messages"> <a href="#sign_messages" class="anchor-heading" aria-labelledby="sign_messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> sign_messages </h4> <h5 id="json-rpc-method-specification-6"> <a href="#json-rpc-method-specification-6" class="anchor-heading" aria-labelledby="json-rpc-method-specification-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON-RPC method specification </h5> <h6 class="no_toc" id="method-6"> <a href="#method-6" class="anchor-heading" aria-labelledby="method-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sign_messages
</code></pre></div></div> <h6 class="no_toc" id="params-6"> <a href="#params-6" class="anchor-heading" aria-labelledby="params-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "addresses": ["&lt;address&gt;", ...],
    “payloads”: [“&lt;message&gt;”, ...],
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">addresses</code>: one or more base64-encoded addresses of the accounts which should be used to sign <code class="language-plaintext highlighter-rouge">message</code>. These should be a subset of the addresses returned by <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> or <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a> for the current session’s authorization.</li> <li><code class="language-plaintext highlighter-rouge">payloads</code>: one or more base64url-encoded message payloads to sign</li> </ul> <h6 class="no_toc" id="result-6"> <a href="#result-6" class="anchor-heading" aria-labelledby="result-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “signed_payloads”: [“&lt;signed_message&gt;”, ...],
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">signed_payloads</code>: the corresponding base64-encoded signed message payloads</li> </ul> <h6 class="no_toc" id="errors-6"> <a href="#errors-6" class="anchor-heading" aria-labelledby="errors-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <ul> <li><code class="language-plaintext highlighter-rouge">-32602</code> (Invalid params) if the params object does not match the format defined above</li> <li><code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code> if the current session is in the unauthorized state, either because <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> or <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a> has not been invoked for the current session, or because the current session’s authorization has been revoked by the wallet endpoint</li> <li> <p><code class="language-plaintext highlighter-rouge">ERROR_INVALID_PAYLOADS</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>“data”: {
    “valid”: [&lt;message_valid&gt;, ...],
}
</code></pre></div> </div> <p>if any message does not represent a valid message for signing, where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">message_valid</code>: an array of booleans with the same length as <code class="language-plaintext highlighter-rouge">payloads</code> indicating which are valid</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">ERROR_NOT_SIGNED</code> if the wallet endpoint declined to sign these messages for any reason</li> <li><code class="language-plaintext highlighter-rouge">ERROR_TOO_MANY_PAYLOADS</code> if the wallet endpoint is unable to sign all messages due to exceeding implementation limits. These limits may be available via <a href="#get_capabilities"><code class="language-plaintext highlighter-rouge">get_capabilities</code></a>.</li> </ul> <h5 id="description-8"> <a href="#description-8" class="anchor-heading" aria-labelledby="description-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h5> <p>The wallet endpoint should present the provided messages for approval. If approved, the wallet endpoint should sign the messages with the private key for the authorized account address, and return the signed messages to the dapp endpoint. The signatures should be appended to the message, in the same order as <code class="language-plaintext highlighter-rouge">addresses</code>.</p> <h4 id="clone_authorization"> <a href="#clone_authorization" class="anchor-heading" aria-labelledby="clone_authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> clone_authorization </h4> <h5 id="json-rpc-method-specification-7"> <a href="#json-rpc-method-specification-7" class="anchor-heading" aria-labelledby="json-rpc-method-specification-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON-RPC method specification </h5> <h6 class="no_toc" id="method-7"> <a href="#method-7" class="anchor-heading" aria-labelledby="method-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clone_authorization
</code></pre></div></div> <h6 class="no_toc" id="params-7"> <a href="#params-7" class="anchor-heading" aria-labelledby="params-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{}
</code></pre></div></div> <h6 class="no_toc" id="result-7"> <a href="#result-7" class="anchor-heading" aria-labelledby="result-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “auth_token”: “&lt;auth_token&gt;”,
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">auth_token</code>: as defined for <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a></li> </ul> <h6 class="no_toc" id="errors-7"> <a href="#errors-7" class="anchor-heading" aria-labelledby="errors-7"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <ul> <li><code class="language-plaintext highlighter-rouge">-32602</code> (Invalid params) if the params object does not match the format defined above</li> <li><code class="language-plaintext highlighter-rouge">-32601</code> (Method not found) if <a href="#clone_authorization"><code class="language-plaintext highlighter-rouge">clone_authorization</code></a> is not supported by this wallet endpoint</li> <li><code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code> if the current session is in the unauthorized state, either because <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a> or <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a> has not been invoked for the current session, or because the current session’s authorization has been revoked by the wallet endpoint</li> <li><code class="language-plaintext highlighter-rouge">ERROR_NOT_CLONED</code> if the wallet endpoint declined to clone the current authorization for any reason</li> </ul> <h5 id="description-9"> <a href="#description-9" class="anchor-heading" aria-labelledby="description-9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Description </h5> <p><em>Implementation of this method by a wallet endpoint is optional.</em></p> <p>This method attempts to clone the session’s currently active authorization in a form suitable for sharing with another instance of the dapp endpoint, possibly running on a different system. Whether or not the wallet endpoint supports cloning an <code class="language-plaintext highlighter-rouge">auth_token</code> is an implementation detail. If this method succeeds, it will return an <code class="language-plaintext highlighter-rouge">auth_token</code> appropriate for sharing with another instance of the same dapp endpoint.</p> <h6 id="non-normative-commentary-3"> <a href="#non-normative-commentary-3" class="anchor-heading" aria-labelledby="non-normative-commentary-3"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non-normative commentary </h6> <p>The <code class="language-plaintext highlighter-rouge">clone_authorization</code> method enables sharing of an authorization between related instances of a dapp endpoint (for example, running on a mobile device and a desktop OS). This is a sensitive operation; dapp endpoints must endeavor to transfer the token securely between dapp endpoint instances. The ability of wallet endpoints to validate the identity of the holder of the cloned token is an implementation detail, and may be weaker than that of the original token. As such, not all wallet endpoints are expected to support this feature.</p> <h3 id="constants"> <a href="#constants" class="anchor-heading" aria-labelledby="constants"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Constants </h3> <p>The protocol defines the following constants:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>const ERROR_AUTHORIZATION_FAILED = -1
const ERROR_INVALID_PAYLOADS = -2
const ERROR_NOT_SIGNED = -3
const ERROR_NOT_SUBMITTED = -4
const ERROR_NOT_CLONED = -5
const ERROR_TOO_MANY_PAYLOADS = -6
const ERROR_CLUSTER_NOT_SUPPORTED = -7

const ERROR_ATTEST_ORIGIN_ANDROID = -100
</code></pre></div></div> <h3 id="illustrative-diagrams"> <a href="#illustrative-diagrams" class="anchor-heading" aria-labelledby="illustrative-diagrams"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Illustrative diagrams </h3> <h4 id="session-establishment-1"> <a href="#session-establishment-1" class="anchor-heading" aria-labelledby="session-establishment-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Session establishment </h4> <p><object data="/mobile-wallet-adapter/spec/uml/4180fcd6bd4446b8576f7b1965b14973.svg" type="image/svg+xml" class="plantuml"></object></p> <h4 id="encrypted-message-wrapping-1"> <a href="#encrypted-message-wrapping-1" class="anchor-heading" aria-labelledby="encrypted-message-wrapping-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Encrypted message wrapping </h4> <p><object data="/mobile-wallet-adapter/spec/uml/ff4f5c17c75b68d71820d20549748f42.svg" type="image/svg+xml" class="plantuml"></object></p> <h4 id="authorize-and-sign-transaction"> <a href="#authorize-and-sign-transaction" class="anchor-heading" aria-labelledby="authorize-and-sign-transaction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Authorize and sign transaction </h4> <p><object data="/mobile-wallet-adapter/spec/uml/6dfec00fd515d686b7792a3f74878913.svg" type="image/svg+xml" class="plantuml"></object></p> <h4 id="reauthorize-and-sign-transaction"> <a href="#reauthorize-and-sign-transaction" class="anchor-heading" aria-labelledby="reauthorize-and-sign-transaction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Reauthorize and sign transaction </h4> <p><object data="/mobile-wallet-adapter/spec/uml/8e8c07cf76899fbffe7ee628ca23caad.svg" type="image/svg+xml" class="plantuml"></object></p> <h2 id="dapp-identity-verification"> <a href="#dapp-identity-verification" class="anchor-heading" aria-labelledby="dapp-identity-verification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dapp identity verification </h2> <p>Dapp endpoint identity verification is domain-based - through various platform-specific mechanisms, a dapp endpoint attests to the wallet that it is associated with a specific web domain. Wallet endpoints are responsible for deciding whether to extend trust to each dapp based on the attested web domain.</p> <h3 id="android-1"> <a href="#android-1" class="anchor-heading" aria-labelledby="android-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Android </h3> <h4 id="native-dapp"> <a href="#native-dapp" class="anchor-heading" aria-labelledby="native-dapp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Native dapp </h4> <p>Identity verification on Android relies on <a href="https://developers.google.com/digital-asset-links/v1/statements">Digital Asset Links</a> to associate apps with a web domain. Both native wallet apps and native dapps on Android should:</p> <ul> <li>Be identified by package name and signing key fingerprint in a <code class="language-plaintext highlighter-rouge">/.well-known/assetlinks.json</code> file hosted on the web domain of the app developer</li> <li>Use <a href="https://developer.android.com/training/app-links">App Links</a> for all Activity <code class="language-plaintext highlighter-rouge">&lt;intent-filter&gt;</code> elements in the app manifest that accept the web domain, (or any subdomain)</li> </ul> <p>Failure to establish these Digital Asset Links will result in the inability of wallet endpoints to verify the identity of dapp endpoints, and puts the users’ funds at risk from malicious dapps.</p> <p>Native dapp endpoints are required to associate with the wallet endpoint using either a <a href="#local-uri">Local URI</a> or an <a href="#endpoint-specific-uris">Endpoint-specific URI</a>, started via an Intent with <a href="https://developer.android.com/reference/android/app/Activity#startActivityForResult(android.content.Intent,%20int)"><code class="language-plaintext highlighter-rouge">startActivityForResult</code></a>. This allows the wallet endpoint to retrieve the calling package identity, with <a href="https://developer.android.com/reference/android/app/Activity#getCallingPackage()"><code class="language-plaintext highlighter-rouge">getCallingPackage</code></a>.</p> <p>To verify the authenticity of the identity provided to <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a>, the wallet endpoint should check the Digital Asset Link for the <code class="language-plaintext highlighter-rouge">identity</code> element URI and ensure that the calling package is signed with a certificate listed in an <code class="language-plaintext highlighter-rouge">android_app</code> statement within the Digital Asset Link file.</p> <p>If the <code class="language-plaintext highlighter-rouge">identity</code> element does not contain a URI, or if the dapp endpoint’s calling package cannot be verified against an <code class="language-plaintext highlighter-rouge">android_app</code> target in the Digital Asset Link file, it is recommended that wallet endpoints decline to issue an authorization token to the dapp endpoint and return <code class="language-plaintext highlighter-rouge">ERROR_AUTHORIZATION_FAILED</code>.</p> <h4 id="web-dapp"> <a href="#web-dapp" class="anchor-heading" aria-labelledby="web-dapp"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Web dapp </h4> <p>Chromium (and related browsers, such as Chrome) associate with the wallet endpoint using either a <a href="#local-uri">Local URI</a> or an <a href="#endpoint-specific-uris">Endpoint-specific URI</a>, started via an Intent with <a href="https://developer.android.com/reference/android/app/Activity#startActivity(android.content.Intent)"><code class="language-plaintext highlighter-rouge">startActivity</code></a>, which does not provide the calling identity. In addition, <a href="https://developer.android.com/reference/android/content/Intent?hl=en#EXTRA_REFERRER"><code class="language-plaintext highlighter-rouge">EXTRA_REFERRER</code></a> may not always be provided in the Intent, and even if it is, it is not a secure source of identity on Android. To provide dapp endpoint identity verification, a different method is required.</p> <p>The browser security sandbox can attest to the origin of a web dapp endpoint, but only within the confines of the sandbox. To extend trust from the browser to the wallet endpoint, it must be brought into the browser security model. <a href="https://developer.chrome.com/docs/android/trusted-web-activity/">Trusted Web Activities</a> enable this by allowing a verifiable <code class="language-plaintext highlighter-rouge">postMessage</code> channel to be established between the native wallet app and the web browser (once again, using <a href="https://developers.google.com/digital-asset-links/v1/statements">Digital Asset Links</a>). Once a channel is established, the wallet app can request that a trusted script running within the browser attest to the identity of the dapp.</p> <p>The wallet endpoint’s software developer must host an HTML document containing an attestation script on a web domain whose Digital Asset Link file contains an <code class="language-plaintext highlighter-rouge">android_app</code> target verifying the wallet endpoint app. This attestation script is responsible for:</p> <ol> <li>Generating an attestation keypair for the wallet endpoint, and issuing the public key to it</li> <li>Attesting to the origin of dapp endpoints, by signing an attestation payload with the requested private key</li> </ol> <p>The contents of this script are an implementation detail of wallet endpoints.</p> <p>On an <a href="#authorize"><code class="language-plaintext highlighter-rouge">authorize</code></a>, <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a>, or <a href="#clone_authorization"><code class="language-plaintext highlighter-rouge">clone_authorization</code></a> attempt from a local web dapp endpoint, the wallet endpoint should check if the provided identity has been authorized during this session. If not, it should return <code class="language-plaintext highlighter-rouge">ERROR_ATTEST_ORIGIN_ANDROID</code> with an identity challenge. The dapp endpoint should load the identity attestation script and use postMessage to convey the dapp endpoint’s origin and the wallet endpoint challenge. The attestation script should construct a response to the challenge containing the origin, sign it with the corresponding wallet attestation private key, and return it to the dapp endpoint. The dapp endpoint should reattempt the failed authorization request, including the attestation response.</p> <h5 id="authorize-reauthorize-and-clone_authorization-modifications"> <a href="#authorize-reauthorize-and-clone_authorization-modifications" class="anchor-heading" aria-labelledby="authorize-reauthorize-and-clone_authorization-modifications"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> authorize, reauthorize, and clone_authorization modifications </h5> <h6 class="no_toc" id="method-8"> <a href="#method-8" class="anchor-heading" aria-labelledby="method-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Method </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>authorize, reauthorize, clone_authorization
</code></pre></div></div> <h6 class="no_toc" id="params-8"> <a href="#params-8" class="anchor-heading" aria-labelledby="params-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Params </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    ...,
    “attest_origin”: “&lt;attest_origin_token&gt;”,
}
</code></pre></div></div> <p>where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">attest_origin_token</code>: a token, generated by <code class="language-plaintext highlighter-rouge">attest_origin_uri</code>, from which the wallet endpoint can verify the authenticity of the <code class="language-plaintext highlighter-rouge">identity</code> parameter to this method</li> </ul> <h6 class="no_toc" id="result-8"> <a href="#result-8" class="anchor-heading" aria-labelledby="result-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Result </h6> <p>No changes</p> <h6 class="no_toc" id="errors-8"> <a href="#errors-8" class="anchor-heading" aria-labelledby="errors-8"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Errors </h6> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
ERROR_ATTEST_ORIGIN_ANDROID
“data”: {
    “context”: “&lt;context&gt;”,
    “challenge”: “&lt;challenge&gt;”,
    “attest_origin_uri”: “&lt;uri&gt;”,
}
</code></pre></div></div> <p>if the <code class="language-plaintext highlighter-rouge">identity</code> provided in params requires verification, where:</p> <ul> <li><code class="language-plaintext highlighter-rouge">context</code>: the attestation context (for e.g., a key ID)</li> <li><code class="language-plaintext highlighter-rouge">challenge</code>: a base64-encoded challenge nonce uniquely identifying this attestation request</li> <li><code class="language-plaintext highlighter-rouge">uri</code>: the URI of the wallet endpoint HTML document containing the attestation script</li> </ul> <p>On receipt of an <code class="language-plaintext highlighter-rouge">ERROR_ATTEST_ORIGIN_ANDROID</code> response, the dapp endpoint should decode the challenge nonce, construct the string <code class="language-plaintext highlighter-rouge">“attest-origin” || decoded_challenge || session_secret</code>, calculate the SHA256 hash of this string, and base64-encode the result. This value, <code class="language-plaintext highlighter-rouge">h</code>, binds <code class="language-plaintext highlighter-rouge">challenge</code> to this dapp endpoint (by including the session secret). It should then construct the JSON message:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    “m: “origin-attest”,
    “h”: &lt;h&gt;,
    “context”: &lt;context&gt;,
}
</code></pre></div></div> <p>The dapp endpoint should load <code class="language-plaintext highlighter-rouge">origin_attest_uri</code> into an invisible iframe, and <code class="language-plaintext highlighter-rouge">postMessage(origin_attest_msg)</code> to it. The dapp endpoint should then await a response message from the iframe (via a message event listener). On receipt, the dapp endpoint should destroy the iframe, and reattempt the authorization request to the wallet endpoint, including the returned message contents as the <code class="language-plaintext highlighter-rouge">attest_origin</code> parameter.</p> <h5 id="non-normative-commentary-4"> <a href="#non-normative-commentary-4" class="anchor-heading" aria-labelledby="non-normative-commentary-4"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Non-normative commentary </h5> <p>Many of the details of this identity verification process are left as an implementation detail of the wallet endpoint. However, as an illustrative example, here is one scheme which could be used to implement identity verification.</p> <p><object data="/mobile-wallet-adapter/spec/uml/28bd482c1a3d549869dac219e81a9b54.svg" type="image/svg+xml" class="plantuml"></object></p> <p>This approach uses a Custom Tab (possibly in Trusted Web Activity mode) with the same browser backend as the association request to securely create the attestation keypair, which is stored in local storage of the wallet endpoints web domain (from which the origin attestation script is fetched). The public keypoint is returned and stored by the wallet.</p> <p>When the wallet determines that an origin attestation is necessary, it returns this same origin attestation script URI to the dapp endpoint, along with the challenge parameters. The dapp endpoint constructs the appropriate origin attestation message, opens the attestation script in an iframe, and sends it the message using postMessage. This provides the dapp endpoint origin to the attestation script, signed with the private keypoint. This message is returned to the dapp endpoint, which then reattempts the authorization request with the message as the attest_origin parameter. The wallet endpoint is able to use the corresponding public keypoint to validate the authenticity of this message, and then subsequently validate the dapp endpoint identity using the token payload.</p> <h3 id="ios-1"> <a href="#ios-1" class="anchor-heading" aria-labelledby="ios-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> iOS </h3> <p><em>iOS support is planned for a future version of this specification</em></p> <h3 id="remote"> <a href="#remote" class="anchor-heading" aria-labelledby="remote"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Remote </h3> <p>No dapp endpoint verification method is defined by this version of the mobile-wallet-adapter protocol. Wallet endpoints are free to perform whatever implementation-specific verification techniques they desire (including rejecting all remote dapp endpoint authorization requests as unverified).</p> <p>If a wallet endpoint supports the <a href="#clone_authorization"><code class="language-plaintext highlighter-rouge">clone_authorization</code></a> method, at a minimum it should also support <a href="#reauthorize"><code class="language-plaintext highlighter-rouge">reauthorize</code></a> on the resulting auth token from a remote dapp endpoint.</p> <h2 id="reflector-protocol"> <a href="#reflector-protocol" class="anchor-heading" aria-labelledby="reflector-protocol"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Reflector protocol </h2> <p>Reflection is an extremely simple protocol; it will reflect all communications received from each endpoint to the other endpoint, up to a maximum size of 4KB per frame.</p> <p>The reflector should listen for WebSocket secure connections to:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wss://&lt;host_authority&gt;/reflect?id=&lt;reflector_unique_id&gt;
</code></pre></div></div> <p>The reflector will maintain two data sets:</p> <ol> <li>Half open reflections - this set contains endpoint connections which are waiting for their corresponding counterparty to connect, along with the connection established time</li> <li>Fully open reflections - this set contains endpoint connections for which the corresponding counterparty has connected, along with the reflection established time</li> </ol> <p>On a new connection, the reflector will take the following action:</p> <ul> <li>If there is an entry in the fully open reflections data set for the specified <code class="language-plaintext highlighter-rouge">reflector_unique_id</code>, the connection will be closed immediately</li> <li>If there is an entry in the half open reflections data set for the specified <code class="language-plaintext highlighter-rouge">reflector_unique_id</code>, that entry will be removed and a new entry added to the fully open reflections data set for the connection pair. Reflection will be started for this connection pair.</li> <li>Otherwise, an entry will be added to the half open reflections data set for this connection. All incoming data on this connection will be silently discarded.</li> </ul> <p>When reflection begins, the reflector will send an <a href="#app_ping"><code class="language-plaintext highlighter-rouge">APP_PING</code></a> message to each connection, and then begin transmitting all messages received from each connection to the other connection in the pair.</p> <p>On a disconnection:</p> <ul> <li>If the connection is part of the fully open reflections data set, the entry will be removed and the other connection closed as well</li> <li>Otherwise, the entry for the connection will be removed from the half-open reflections data set</li> </ul> <p>Entries in the half open data set should be removed, and the connection closed, if still present in this set no less than 30 seconds after being added. Entries in the fully open data set should be removed, and both connections closed, if still present in this set no less than 90 seconds after being added. Entries in either data set may also be removed, and the connection(s) closed, before these time periods have elapsed at the discretion of the reflector (for e.g., during periods of limited resource availability).</p> <p>To ensure that all active connections are maintained, the reflector shall ensure that periodic <a href="https://datatracker.ietf.org/doc/html/rfc6455#section-5.5.2"><code class="language-plaintext highlighter-rouge">PING</code></a> frames are sent to each connection.</p> <h1 id="support-for-other-chains"> <a href="#support-for-other-chains" class="anchor-heading" aria-labelledby="support-for-other-chains"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Support for other chains </h1> <p>While the initial version of this specification is designed to support the Solana network, future support for other chain types is envisioned. This could be accomplished with:</p> <ul> <li>modified association URIs (using schemes of the form <code class="language-plaintext highlighter-rouge">newchain-wallet://</code> instead of <code class="language-plaintext highlighter-rouge">solana-wallet://</code>)</li> <li>modified parameters to the RPC methods <ul> <li><code class="language-plaintext highlighter-rouge">authorize</code> would have a different set of chain identifiers</li> <li><code class="language-plaintext highlighter-rouge">get_capabilities</code> would be used to express domain-specific capabilities relevant to the chain</li> <li><code class="language-plaintext highlighter-rouge">sign_and_send_transactions</code> would use chain-specific shapes for the <code class="language-plaintext highlighter-rouge">options</code> object</li> </ul> </li> </ul> <p>The specifics of the application of Mobile Wallet Adapter to each additional chain would be captured either with an update to this specification, or an extension accompanying this specification, as appropriate.</p> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
